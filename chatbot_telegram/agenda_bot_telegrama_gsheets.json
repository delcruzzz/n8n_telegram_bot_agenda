{
  "name": "agenda_bot_telegrama_gsheets",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -2480,
        0
      ],
      "id": "0ac50d19-8446-409e-905a-ee4ffa970174",
      "name": "Telegram Trigger",
      "webhookId": "948ebbff-e0c4-40d5-bdcf-1c2ecf92fa19",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "251e8046-d947-40af-8980-798f02606082",
              "name": "telegram_user",
              "value": "={{ $json.message.from.id }}",
              "type": "string"
            },
            {
              "id": "3cab2bf4-d2ef-4c47-b188-446850124d14",
              "name": "username",
              "value": "={{ $json.message.from.first_name }}",
              "type": "string"
            },
            {
              "id": "f634c0bf-8967-4ab3-8cb3-e97098ea4514",
              "name": "text",
              "value": "={{ $json.message.text }}",
              "type": "string"
            },
            {
              "id": "ae0d9249-dafd-4812-960a-491ab5514ca8",
              "name": "now_ts",
              "value": "={{ $now }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2272,
        0
      ],
      "id": "f90e7507-b2ef-47d6-84ea-a2c6819ef6f1",
      "name": "normalización de datos"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 373334979,
          "mode": "list",
          "cachedResultName": "USUARIOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=373334979"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_user",
              "lookupValue": "={{ $json.telegram_user }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -2064,
        0
      ],
      "id": "9b3f449b-a4da-4df0-bee9-7b8e4b3e4ba7",
      "name": "busca usuario",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "d2194323-26ad-449f-a609-f2d4ea45ef0e",
              "leftValue": "={{ Object.keys($node[\"busca usuario\"].json).length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -1856,
        0
      ],
      "id": "b8a4189f-4109-4e73-bdb5-bf2d1c9006ed",
      "name": "¿existe usuario?"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 373334979,
          "mode": "list",
          "cachedResultName": "USUARIOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=373334979"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "nombre": "={{ $('normalización de datos').item.json.username }}",
            "rol": "admin",
            "permitido": "true"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "rol",
              "displayName": "rol",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "permitido",
              "displayName": "permitido",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1744,
        320
      ],
      "id": "a862c54e-6b54-4ee5-84f6-bb817eb65d7a",
      "name": "crear usuario",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_principal",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1552,
        432
      ],
      "id": "fbe14aa5-be4a-4dbc-8c20-a9c5a996f441",
      "name": "crear sesión inicial",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "telegram_user",
              "lookupValue": "={{ $('normalización de datos').item.json.telegram_user }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1408,
        -128
      ],
      "id": "dea142b3-2d49-447d-a903-49146a3e047e",
      "name": "obtener sesión existente",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2e37fddb-9949-4810-a1b8-a92b95522801",
              "name": "pantalla_actual",
              "value": "={{ $json.pantalla_actual }}",
              "type": "string"
            },
            {
              "id": "e9ac4682-06e1-4133-b126-13118e5208b5",
              "name": "paso_actual",
              "value": "={{ $json.paso_actual }}",
              "type": "number"
            },
            {
              "id": "0d920587-eed6-4803-a622-54e7054e4967",
              "name": "datos_parciales",
              "value": "={{ $json.datos_parciales }}",
              "type": "string"
            },
            {
              "id": "11c167b8-d5f6-4ef8-b7ea-6d650aab6960",
              "name": "telegram_user",
              "value": "={{ $('normalización de datos').item.json.telegram_user }}",
              "type": "string"
            },
            {
              "id": "dffe01ac-4c81-4634-a54d-5d79222e3bd0",
              "name": "text",
              "value": "={{ $('Telegram Trigger').item.json.message.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1168,
        -128
      ],
      "id": "6aecfdd5-1d9b-4b61-ada2-16eea5b6e42f",
      "name": "normalizar sesión actual"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "04063365-d693-447e-b207-336bb02d9d8c",
              "leftValue": "={{ $json.pantalla_actual }}",
              "rightValue": "menu_principal",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -896,
        -128
      ],
      "id": "35392fa0-adb4-47f5-8dff-314854abb824",
      "name": "¿estoy en menú principal?"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "0408c847-d66f-4208-8355-b00c0035be44",
              "leftValue": "={{ $json.text }}",
              "rightValue": "0",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "d9cbd54e-f6ce-490a-adba-b658c1148c3b",
              "leftValue": "={{ $json.text }}",
              "rightValue": "1",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "60bb64f5-bf1b-485b-be82-6d75e618c326",
              "leftValue": "={{ $json.text }}",
              "rightValue": "2",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "9a315d55-bdfb-4768-bdac-2ea12f6b4cf4",
              "leftValue": "={{ $json.text }}",
              "rightValue": "3",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "f717dd9f-3f77-4348-b6f1-cb533b448798",
              "leftValue": "={{ $json.text }}",
              "rightValue": "4",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "97d9cd37-515a-4a2c-87f5-e9d98b2bff60",
              "leftValue": "={{ $json.text }}",
              "rightValue": "5",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "a13b7002-4778-40c8-8176-ceef578495d5",
              "leftValue": "={{ $json.text }}",
              "rightValue": "6",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "1548f50a-2cc8-464e-9e15-cee470466940",
              "leftValue": "={{ $json.text }}",
              "rightValue": "7",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "585b30ee-5450-4df7-9f47-35220b540569",
              "leftValue": "={{ $json.text }}",
              "rightValue": "8",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -752,
        -2416
      ],
      "id": "07a2d95e-d30b-4cfc-bc40-89263341f665",
      "name": "¿opción valida?"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "0",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "8c2b4b02-3eac-4b83-85f0-a903e18f3249"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "5cd9e594-f670-4d12-b788-346db4b70db3",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "a0290530-8181-4bfe-8623-f3a56e4fd30f",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "8cfeb785-0b9c-44d7-9590-75120f2e4a6c",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "f60f2f1e-1118-4520-9051-9d662ac47ea8",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "4",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "15d6dfc6-bbc1-4d2d-b978-eaa60a8cede2",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "5",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "b0c5f36d-bf82-46a6-a66a-28b19b7b1453",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "6",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "reportes"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "8408d61c-bc47-4d99-b4a6-e1f67045117c",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "7",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "ee042844-cd5b-420a-92c7-563d4d990c34",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "=8",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -512,
        -3280
      ],
      "id": "a6e3adc9-c345-49ff-ad7f-003c0a473760",
      "name": "opciones del menú principal"
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Ups, esa opción no existe en este menú.\n\nPor favor escribe uno de los números que ves en pantalla.\n\nEstás en: Menú principal\nOpciones disponibles: 0 al 8",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -544,
        -2288
      ],
      "id": "9c6ad4d6-2543-4666-a4de-f8990a810c76",
      "name": "mensaje de opción invalida",
      "webhookId": "a7c88925-00d6-456f-9a51-692e859fcbf4",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_agenda",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -128,
        -4000
      ],
      "id": "a436651c-67d5-4ab3-ab9f-975d815ec611",
      "name": "actualizar sesión a menú agenda",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Perfecto, vamos con tu agenda.\n\n¿Qué deseas hacer?\n\n1. Agendar una nueva cita\n2. Consultar tu agenda\n3. Reprogramar una cita\n4. Cancelar una cita\n5. Marcar una cita como completada\n9. Volver al menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        64,
        -4240
      ],
      "id": "9a9c9f4e-62d2-43f1-ac45-10ff44e7bdec",
      "name": "mensaje de menú agenda",
      "webhookId": "4d3b8e2f-dd2e-4d81-8ff4-5b1c9da8b236",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Si quieres empezar rápido, te recomiendo la opción 1 (Agenda)\n\n¿En qué te puedo ayudar hoy?\n\nMenú principal:\n0. Ayuda\n1. Agenda (citas)\n2. Tareas\n3. Recordatorios\n4. Hábitos\n5. Listas\n6. Reportes\n7. Configuración\n8. Administrador",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -208,
        -4240
      ],
      "id": "e86df194-2bcc-4748-973c-17e2a6aee0dd",
      "name": "enviar ayuda y menú principal",
      "webhookId": "09a0179e-c249-4432-9550-2b11535c29c4",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $now }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla": "menu_principal",
            "opcion_elegida": "text",
            "resultado": "ok (ayuda)"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        16,
        -4464
      ],
      "id": "e240a55d-be11-4b55-a3ce-2cbd491928bc",
      "name": "log de ayuda",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $now }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla": "menu_principal",
            "opcion_elegida": "1",
            "resultado": "ok (menú agenda)"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        320,
        -4480
      ],
      "id": "10163d1c-fbf0-4c22-b6a0-63b1992e3af3",
      "name": "log de menú agenda",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "43f4d1b1-ea13-4414-b005-792f7e1507d8",
              "leftValue": "={{ $('normalizar sesión actual').item.json.pantalla_actual }}",
              "rightValue": "menu_agenda",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        1536,
        -4992
      ],
      "id": "ed96d254-3247-4a17-bfde-186d1e4dbbe1",
      "name": "¿estoy en menú agenda?"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "921dea9c-cf42-4237-addd-a49e285107b9",
              "leftValue": "={{ $json.text }}",
              "rightValue": "1",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "fc752b8b-da86-4f6e-abeb-ef7a6513ab1a",
              "leftValue": "={{ $json.text }}",
              "rightValue": "2",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "5704e9f9-030c-4785-8931-7a5a30a648bc",
              "leftValue": "={{ $json.text }}",
              "rightValue": "3",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "2a75dea3-26ed-4c63-a115-1699495fb673",
              "leftValue": "={{ $json.text }}",
              "rightValue": "4",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "3c7c9d54-b787-456d-b49b-068fef51d541",
              "leftValue": "={{ $json.text }}",
              "rightValue": "5",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "b7e10367-65bb-452c-8db7-06174fa9e932",
              "leftValue": "={{ $json.text }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        24288,
        -12640
      ],
      "id": "fdd36f47-2c3d-4298-a32f-3e500730992b",
      "name": "¿opción valida en menú agenda?"
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Ups, esa opción no existe en este menú.\n\nPor favor escribe uno de los números que ves en pantalla.\n\nEstás en: Menú agenda\nOpciones disponibles: 1 al 5, y 9",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        24528,
        -12752
      ],
      "id": "2438314b-e35e-484f-8a3e-8efc417b23ce",
      "name": "mensaje opción invalida menú agenda",
      "webhookId": "2ab8055f-2db0-4d90-ae28-53e9873f3717",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "wz_cita_fecha",
            "paso_actual": "1",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        24672,
        -14128
      ],
      "id": "96cb29a4-3b3a-4e3e-bd1f-ffc072d7a5e6",
      "name": "actualizar sesión a wz_cita_fecha",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Empecemos a crear tu cita.\n\nPaso 1 de 6\n¿Cuál es la fecha de la cita?\n\nFormato: YYYY-MM-DD\nEjemplo: 2025-12-20\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        24880,
        -14224
      ],
      "id": "a17e8b1f-0959-4626-97b2-9c02fe60c369",
      "name": "enviar mensaje agregar fecha a cita",
      "webhookId": "e100379e-a723-4347-982d-6b708b3acdd0",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "e9e609ee-c575-4d50-beda-744a1cabd6a5"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "1043505f-7be4-4c9b-bd80-4e262a089a04",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "0d833cce-794e-4995-88c3-987afeedd3f1",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "85346329-285f-4ba3-8d59-6baa834c6f06",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "4",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "31f96f9b-28ea-42bd-9fc2-c372ee97c2bb",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "5",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "b6d79457-c352-4c37-9174-ba1ab172409e",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        24480,
        -13680
      ],
      "id": "89c198ce-95af-4161-8fde-9b11c0512a9b",
      "name": "opciones de menú agenda"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $now }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla": "menu_agenda",
            "opcion_elegida": "1",
            "resultado": "ok -> wz_cita_fecha (pedir fecha)"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25088,
        -14256
      ],
      "id": "3edeff81-0aa9-444e-9480-1abba5cbaa5b",
      "name": "log de pedir fecha en cita",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "c5366e3c-dd21-44c6-9bfc-7016d7f64a86",
              "leftValue": "={{ $json.text }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        24416,
        -12416
      ],
      "id": "13e2a402-7de1-482c-8ed3-7139153dd55e",
      "name": "¿canceló desde fecha?"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_agenda",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        24800,
        -12704
      ],
      "id": "5cda5a73-3d55-49e5-8876-3c755bd50a70",
      "name": "actualizar sesión a menú agenda después de cancelar desde fecha",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Proceso cancelado.\n\n¿Qué deseas hacer?\n\n1. Agendar una nueva cita\n2. Consultar tu agenda\n3. Reprogramar una cita\n4. Cancelar una cita\n5. Marcar una cita como completada\n9. Volver al menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        25056,
        -12704
      ],
      "id": "1b1dee78-2fab-4408-bbe8-bc9369abca6a",
      "name": "enviar menú agenda después de cancelar desde fecha",
      "webhookId": "5e0f2710-87b4-482d-987d-06dee0328a42",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "ade18067-2120-46c2-9d06-0304c150fb8e",
              "leftValue": "={{ $('¿estoy en menú principal?').item.json.text }}",
              "rightValue": "^\\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])$",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        24704,
        -12464
      ],
      "id": "a1a984cd-ee3c-4058-9068-3931f32f51ab",
      "name": "¿fecha valida?"
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Fecha inválida. Ej: 2025-12-20. \n\n9 cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        24928,
        -12208
      ],
      "id": "1efacefe-13e5-4044-8cd3-edd2bbc3b61b",
      "name": "enviar mensaje de fecha invalida",
      "webhookId": "81692975-ace6-4bff-ba53-3afebba9d802",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $now }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla": "menu_agenda"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25120,
        -12208
      ],
      "id": "6b7a6afd-d55c-4764-a69b-8004e9655e06",
      "name": "log fecha invalida",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3f2c0af0-b991-4561-871d-12933cef9ecf",
              "name": "fecha",
              "value": "={{ $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        24928,
        -12464
      ],
      "id": "549a5cf8-bbf5-400b-bd6d-4e284bae727f",
      "name": "guardar fecha en datos_parciales"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "timestamp_ultima_interaccion": "={{ $now }}",
            "datos_parciales": "=fecha={{ $json.fecha }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25104,
        -12464
      ],
      "id": "2aeceb72-8ce7-4cab-ad58-44110efe4cc8",
      "name": "agregar fecha en datos_parciales",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "wz_cita_hora",
            "paso_actual": "2",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25312,
        -12464
      ],
      "id": "2da64cf8-62f8-47a6-9b81-1c8f06d530b7",
      "name": "actualizar sesión a wz_cita_hora",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Paso 2 de 6\n¿A qué hora será? HH:MM (24h) Ej: 14:30\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        25520,
        -12464
      ],
      "id": "19e3543e-334e-4c34-8c6f-32e7ceb5557a",
      "name": "enviar mensaje agregar hora a cita",
      "webhookId": "53bf04bf-49e6-461e-a07c-e817983a304d",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $now }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla": "menu_agenda",
            "opcion_elegida": "1",
            "resultado": "ok -> wz_cita_hora (pedir hora)"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25728,
        -12464
      ],
      "id": "b665dce4-e422-42ba-b988-f15b3f0348cf",
      "name": "log de pedir hora en cita",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "b5f0ff83-c073-4ac9-b31b-6bcdc543f131",
              "leftValue": "={{ $json.text }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        24480,
        -12064
      ],
      "id": "7db6c4dc-9ac6-43d5-8485-733062c6f388",
      "name": "¿canceló desde hora?"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_agenda",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        24720,
        -12096
      ],
      "id": "c234f57d-f978-4a82-be68-48c3cdd8def9",
      "name": "actualizar sesión a menú agenda después de cancelar desde hora",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Proceso cancelado.\n\n¿Qué deseas hacer?\n\n1. Agendar una nueva cita\n2. Consultar tu agenda\n3. Reprogramar una cita\n4. Cancelar una cita\n5. Marcar una cita como completada\n9. Volver al menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        24944,
        -11920
      ],
      "id": "9947467a-9949-4e17-89b2-6def33c9cf4b",
      "name": "enviar menú agenda después de cancelar desde hora",
      "webhookId": "ddf444c5-66c4-4187-a3b5-e613ade1752b",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "f9cf8390-fb3a-42e9-9ed1-1a34175cc3b9",
              "leftValue": "={{ $json.text }}",
              "rightValue": "^([01]\\d|2[0-3]):[0-5]\\d$",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        24736,
        -11680
      ],
      "id": "c50621da-338c-4fa8-9e28-bc3643b1c73c",
      "name": "¿hora valida?"
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Hora inválida. Ej: 14:30 (24h). \n\nEscribe 9 para cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        24944,
        -11472
      ],
      "id": "d5d453b5-a604-4d14-889f-12911232221f",
      "name": "enviar mensaje de hora invalida",
      "webhookId": "da5e0563-c4eb-410c-9352-83f3195a02d6",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $now }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla": "menu_agenda"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25152,
        -11472
      ],
      "id": "b071fd6b-5d88-4e56-9b01-ec2792090584",
      "name": "log hora invalida",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "66e76bbe-9717-479c-b77c-994d8ae57e94",
              "name": "datos_parciales",
              "value": "={{ $json.datos_parciales + '|hora=' + $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        24944,
        -11696
      ],
      "id": "a1505fa6-ab76-4a84-9539-4879641d09c1",
      "name": "guardar hora en datos_parciales"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "timestamp_ultima_interaccion": "={{ $now }}",
            "datos_parciales": "={{ $json.datos_parciales }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25136,
        -11696
      ],
      "id": "55acea86-1ca9-4427-a2ab-838d6e19bff9",
      "name": "agregar hora en datos_parciales",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "wz_cita_nombre",
            "paso_actual": "3",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25328,
        -11696
      ],
      "id": "ed01db48-44ed-4606-bc56-c66fc1bf769a",
      "name": "actualizar sesión a wz_cita_nombre",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Paso 3 de 6\n¿A nombre de quién es la cita?\nEscribe el nombre completo.\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        25520,
        -11696
      ],
      "id": "e9211a8d-1d77-4509-a98b-876c3c2058e2",
      "name": "enviar mensaje agregar nombre a cita",
      "webhookId": "99ca0cbe-196c-4cb0-95ec-0c90d345867a",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $now }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla": "menu_agenda",
            "opcion_elegida": "1",
            "resultado": "ok -> wz_cita_nombre (pedir nombre)"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25728,
        -11696
      ],
      "id": "4f4e3e8a-136a-4692-bc67-395a487d1914",
      "name": "log de pedir nombre en cita",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "6ec1a872-b9f5-459a-ac65-d8c22541dbfd",
              "leftValue": "={{ $json.text }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        24528,
        -11200
      ],
      "id": "8d6bce92-bcaa-4c7d-98c3-397521207d11",
      "name": "¿canceló desde nombre?"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_agenda",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        24800,
        -11216
      ],
      "id": "bf6f1f4d-15be-4db7-a1aa-2587863dab34",
      "name": "actualizar sesión a menú agenda después de cancelar desde nombre",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Proceso cancelado.\n\n¿Qué deseas hacer?\n\n1. Agendar una nueva cita\n2. Consultar tu agenda\n3. Reprogramar una cita\n4. Cancelar una cita\n5. Marcar una cita como completada\n9. Volver al menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        25056,
        -11216
      ],
      "id": "bca8a041-8fbc-4e2b-8ed3-5c180e481f05",
      "name": "enviar menú agenda después de cancelar desde nombre",
      "webhookId": "399e890d-6f74-4a94-a7c1-7d60fad836f6",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "48e4f445-ac84-410f-a84b-e2c2c81d54e7",
              "leftValue": "={{ $json.text }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            },
            {
              "id": "524f2ba7-c91e-4a0a-a80a-85b5fcf543ba",
              "leftValue": "={{ $json.text.length }}",
              "rightValue": 2,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        24800,
        -10928
      ],
      "id": "95f344c6-c4c8-46f0-afb0-2659c8f9de98",
      "name": "¿nombre válido?"
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=El nombre no puede estar vacío.\n\nEscribe el nombre completo o 9 para cancelar.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        25008,
        -10768
      ],
      "id": "281bb7b7-4070-4441-8727-81ade163925c",
      "name": "enviar mensaje de nombre invalido",
      "webhookId": "28d9d52a-7efd-4de4-8fbc-795f10079440",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $now }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla": "menu_agenda"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25216,
        -10768
      ],
      "id": "da1ccb16-28b7-4f30-803d-132dc548d5af",
      "name": "log nombre invalido",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d515ca7b-3c47-4065-a37b-8736069418e8",
              "name": "datos_parciales",
              "value": "={{ $json.datos_parciales + '|nombre=' + $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        25008,
        -10992
      ],
      "id": "0d3518e1-9c62-47df-a783-b6ac1420a484",
      "name": "guardar nombre en datos_parciales"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "datos_parciales": "={{ $json.datos_parciales }}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25216,
        -10992
      ],
      "id": "4571d4b4-570e-4778-bc6a-a7e2aa912f99",
      "name": "agregar nombre en datos_parciales",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "wz_cita_motivo",
            "paso_actual": "4",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25424,
        -10992
      ],
      "id": "e5e86f84-c1e9-489c-a2d9-c87a50f18fb1",
      "name": "actualizar sesión a wz_cita_motivo",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Paso 4 de 6\nCuéntame brevemente el motivo de la cita.\n\nEjemplo: Asesoría técnica\n\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        25632,
        -10992
      ],
      "id": "6f70c823-0669-426e-9d3b-ec4df83266e4",
      "name": "enviar mensaje agregar motivo a cita",
      "webhookId": "48573314-586d-4502-ae3f-6ad9b607b2d6",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $now }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla": "menu_agenda",
            "opcion_elegida": "1",
            "resultado": "ok -> wz_cita_nombre (pedir motivo)"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25872,
        -10992
      ],
      "id": "48cedc18-d6aa-43c1-9de5-3adcaeee2a84",
      "name": "log de pedir motivo en cita",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "d24d046e-1c45-4ee4-b1a6-4769d279728b",
              "leftValue": "={{ $json.text }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        24544,
        -10512
      ],
      "id": "5da8fa34-115c-48ff-90c1-066237b083f1",
      "name": "¿canceló desde motivo?"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_agenda",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        24848,
        -10528
      ],
      "id": "067c070a-acb0-4ade-8df0-b8a9433967c1",
      "name": "actualizar sesión a menú agenda después de cancelar desde motivo",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Proceso cancelado.\n\n¿Qué deseas hacer?\n\n1. Agendar una nueva cita\n2. Consultar tu agenda\n3. Reprogramar una cita\n4. Cancelar una cita\n5. Marcar una cita como completada\n9. Volver al menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        25088,
        -10528
      ],
      "id": "feecaa0e-6d06-4943-9ab8-e506aaf508ea",
      "name": "enviar menú agenda después de cancelar desde motivo",
      "webhookId": "4ca2f5d8-54fa-46c9-8841-6609f93d8cde",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8e2e5f1d-9e5a-45e2-bcc7-244f9997e779",
              "leftValue": "={{ $json.text }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            },
            {
              "id": "5092e004-b0cf-4f62-baf4-6d8898a61a83",
              "leftValue": "={{ $json.text.length }}",
              "rightValue": 3,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        24848,
        -10288
      ],
      "id": "ffbfee8a-f679-4507-be99-622fd3aa9d0c",
      "name": "¿motivo valido?"
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=El motivo no puede estar vacio. Ej: Asesoría técnica.\n\nEscribe un motivo o 9 para cancelar.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        25024,
        -10096
      ],
      "id": "0fc75a35-4f98-412a-8ac3-ac9d350ff28f",
      "name": "enviar mensaje de motivo invalido",
      "webhookId": "94e72f86-1387-497e-83aa-2e02c30566a5",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $now }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla": "menu_agenda"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25232,
        -10096
      ],
      "id": "7895fb63-89b1-4715-8936-815e093eeee3",
      "name": "log motivo invalido",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1844ab74-84db-4901-a513-68f2f4ad14c8",
              "name": "datos_parciales",
              "value": "={{ $json.datos_parciales + '|motivo=' + $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        25072,
        -10304
      ],
      "id": "b4889759-7a0b-4607-ac06-f63a63f8d38c",
      "name": "guardar motivo en datos_parciales"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "wz_cita_canal",
            "paso_actual": "5",
            "datos_parciales": "={{ $('guardar motivo en datos_parciales').item.json.datos_parciales }}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25472,
        -10304
      ],
      "id": "65844949-0a67-48ff-9d11-81a4cc1125d5",
      "name": "actualizar sesión a wz_cita_canal",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Paso 5 de 6\n¿Cómo será la atención?\n\n1. Presencial\n2. Virtual\n3. Llamada\n9. Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        25680,
        -10304
      ],
      "id": "633ed856-3eb3-4077-8d84-146f3be40b03",
      "name": "enviar mensaje agregar canal cita",
      "webhookId": "990b14a2-7b8f-4c09-9850-24f3ce68acac",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $now }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla": "menu_agenda",
            "opcion_elegida": "1",
            "resultado": "ok -> wz_cita_motivo (pedir canal)"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25936,
        -10304
      ],
      "id": "7494e676-e0db-43e4-a8d1-a443a6a34c41",
      "name": "log de pedir canal en cita",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "2ce5d053-4c32-48d4-9573-4a750f6d3050",
              "leftValue": "={{ $json.text }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        24816,
        -9904
      ],
      "id": "7fe174af-ceb0-4064-b8f6-7a31b949e900",
      "name": "¿canceló desde canal?"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "675a30a9-951b-4ffd-85a4-b41371947719",
              "leftValue": "={{ $json.text }}",
              "rightValue": "1",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "b8e0d6c6-e549-4246-97d7-12548a802971",
              "leftValue": "={{ $json.text }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "5b56b000-a0dd-4944-bee7-f482fdf03be9",
              "leftValue": "={{ $json.text }}",
              "rightValue": "3",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        25008,
        -9632
      ],
      "id": "47e02adb-fba0-4e3d-9403-9b586a795918",
      "name": "¿canal válido?"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "857d848d-b12b-49ca-8a3f-fd3fa23c65a6"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "presencial"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "6f9b3dc8-9c41-45e0-a679-4e85448e685f",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "virtual"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "5c9e10d2-d659-49ad-b12b-87f137c2cfd4",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "llamada"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        25728,
        -9664
      ],
      "id": "a992d60a-028b-4707-ab42-7da151b7aa06",
      "name": "elección de canal"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f212f217-cbbd-4cea-b339-a084a04f68f5",
              "name": "datos_parciales",
              "value": "={{ $json.datos_parciales + '|canal=presencial' }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        26032,
        -9728
      ],
      "id": "1f4785c1-2476-4148-bab1-252132737c1b",
      "name": "guardar canal presencial en datos_parciales"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d1dab899-c9b4-417b-9679-0e8d9e39db56",
              "name": "datos_parciales",
              "value": "={{ $json.datos_parciales + '|canal=virtual' }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        26032,
        -9504
      ],
      "id": "2c8592d2-7563-4026-a31b-65d3dbbbcf2f",
      "name": "guardar canal virtual en datos_parciales"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "fb6859e1-7597-407f-837d-e5dc5e131dd3",
              "name": "datos_parciales",
              "value": "={{ $json.datos_parciales + '|canal=llamada' }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        26032,
        -9280
      ],
      "id": "b534d9a7-420e-4360-a701-82ef6acf1bec",
      "name": "guardar canal llamada en datos_parciales"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "datos_parciales": "={{ $json.datos_parciales }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25264,
        -10304
      ],
      "id": "18ef7703-45d5-4872-aea5-d4ca02cdfb25",
      "name": "agregar motivo en datos_parciales",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "datos_parciales": "={{ $json.datos_parciales }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        26304,
        -9728
      ],
      "id": "7eea6a65-28ed-4fb6-a9ed-af499202c67f",
      "name": "agregar canal presencial en datos_parciales",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "datos_parciales": "={{ $json.datos_parciales }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        26304,
        -9504
      ],
      "id": "2de4a5c6-4a86-4f99-a6b3-0ec2dff4c31a",
      "name": "agregar canal virtual en datos_parciales",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "datos_parciales": "={{ $json.datos_parciales }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        26304,
        -9280
      ],
      "id": "8828503c-b4db-41b5-8d2c-632a4e1d4b86",
      "name": "agregar canal llamada en datos_parciales",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "wz_cita_confirm",
            "paso_actual": "6",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        26528,
        -9728
      ],
      "id": "9079c93d-e6fe-488f-b3d4-95ddfe616950",
      "name": "actualizar sesión a wz_cita_confirm desde presencial",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "wz_cita_confirm",
            "paso_actual": "6",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        26528,
        -9504
      ],
      "id": "447795e7-91a8-4540-a9bb-6436509856d8",
      "name": "actualizar sesión a wz_cita_confirm desde virtual",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "wz_cita_confirm",
            "paso_actual": "6",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        26528,
        -9280
      ],
      "id": "2e8761be-8b4c-4b6a-86fa-27b82f7f6bda",
      "name": "actualizar sesión a wz_cita_confirm desde llamada",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Paso 6 de 6 — Confirmación ✅\n\nEstos son los datos de tu cita:\n{{ $('guardar canal presencial en datos_parciales').item.json.datos_parciales }}\n\n¿Qué deseas hacer?\n1. Confirmar y guardar\n2. Editar (reiniciar)\n3. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        26816,
        -9728
      ],
      "id": "671072bb-8cc8-422b-8c79-e896c239807c",
      "name": "enviar mensaje confirmar cita desde canal presencial",
      "webhookId": "824995d1-0333-4c96-9d58-02e89ecc5ac6",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Paso 6 de 6 — Confirmación ✅\n\nEstos son los datos de tu cita:\n{{ $('guardar canal virtual en datos_parciales').item.json.datos_parciales }}\n\n¿Qué deseas hacer?\n1. Confirmar y guardar\n2. Editar (reiniciar)\n3. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        26816,
        -9504
      ],
      "id": "b8e0f201-f352-4e02-ace1-4893964c7d78",
      "name": "enviar mensaje confirmar cita desde canal virtual",
      "webhookId": "824995d1-0333-4c96-9d58-02e89ecc5ac6",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Paso 6 de 6 — Confirmación ✅\n\nEstos son los datos de tu cita:\n{{ $('guardar canal llamada en datos_parciales').item.json.datos_parciales }}\n\n¿Qué deseas hacer?\n1. Confirmar y guardar\n2. Editar (reiniciar)\n3. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        26816,
        -9280
      ],
      "id": "60b92e1a-19eb-44f9-a813-fc9b3c9393a1",
      "name": "enviar mensaje confirmar cita desde canal llamada",
      "webhookId": "824995d1-0333-4c96-9d58-02e89ecc5ac6",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_agenda",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25200,
        -9824
      ],
      "id": "c9c7a290-ada8-425c-98f4-7c344fe1c31a",
      "name": "actualizar sesión a menú agenda después de cancelar desde canal",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Proceso cancelado.\n\n¿Qué deseas hacer?\n\n1. Agendar una nueva cita\n2. Consultar tu agenda\n3. Reprogramar una cita\n4. Cancelar una cita\n5. Marcar una cita como completada\n9. Volver al menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        25424,
        -9824
      ],
      "id": "c11d6b64-7083-43f6-90e6-ee949b2efa52",
      "name": "enviar menú agenda después de cancelar desde canal",
      "webhookId": "3af0ad0e-39bd-4ff5-8d79-52203c5547a3",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=El motivo no puede estar vacio. Ej: Asesoría técnica.\n\nEscribe un motivo o 9 para cancelar.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        25200,
        -9488
      ],
      "id": "f6de08fe-5803-445c-97a1-82e20bb7a3ee",
      "name": "enviar mensaje de canal invalido",
      "webhookId": "c5064cbe-25cf-4e97-9f99-911c37501550",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $now }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla": "menu_agenda"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25408,
        -9488
      ],
      "id": "6c3cee76-640d-418e-aaf6-dabad0faa1f4",
      "name": "log canal invalido",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $now }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla": "menu_agenda",
            "resultado": "ok -> wz_cita_confrim (pedir confirmación)"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        27232,
        -9504
      ],
      "id": "7fd55847-4162-41a3-88a2-1bda77359e9f",
      "name": "log de pedir confirmación en cita",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "997841da-0ed5-40a0-86cf-d40a3a7df649",
              "leftValue": "={{ $json.text }}",
              "rightValue": "1",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "aeafd55f-0b00-40b5-b95a-5cc3b54be5e0",
              "leftValue": "={{ $json.text }}",
              "rightValue": "2",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "b08fcbf6-ef54-4cba-8eb4-6eadf4c31cf0",
              "leftValue": "={{ $json.text }}",
              "rightValue": "3",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        24848,
        -9248
      ],
      "id": "2b3f9442-819a-42f9-9530-ed1c9037c690",
      "name": "¿opción valida desde confirmación?"
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Ups, esa opción no existe en Confirmación.\n\nOpciones:\n1 Confirmar y guardar\n2 Editar información\n3 Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        24944,
        -8672
      ],
      "id": "3a50a9db-acf8-42b7-bbc5-f10793afb562",
      "name": "enviar mensaje de opción de confirmación invalida",
      "webhookId": "52d3982f-e81d-482b-a042-6069859bfbf9",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla": "menu_agenda",
            "resultado": "invalid"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25152,
        -8304
      ],
      "id": "6bd142d9-8ce2-45e5-894e-ab84cef4230c",
      "name": "log opción de confirmación invalida",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "e8405582-6bf4-412e-803e-1f1dd943b6af"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "confirmar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "3a26b5a7-99aa-4282-8d75-9bf034e592aa",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "editar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4e65f7b9-066d-4e12-8ea5-b7d97a238b74",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "cancelar"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        25040,
        -9024
      ],
      "id": "d00a2126-b460-4a6d-921a-1a18d2cb6283",
      "name": "elección de opciones de confirmación"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_agenda",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25216,
        -8640
      ],
      "id": "3152f979-d028-403c-a618-df26b1d30a78",
      "name": "actualizar sesión después de cancelar desde confirmación",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Proceso cancelado.\n\n¿Qué deseas hacer?\n\n1. Agendar una nueva cita\n2. Consultar tu agenda\n3. Reprogramar una cita\n4. Cancelar una cita\n5. Marcar una cita como completada\n9. Volver al menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        25472,
        -8512
      ],
      "id": "f46bc5dc-5701-48a7-95b9-393c2820ca3e",
      "name": "enviar menú agenda después de cancelar desde confirmación",
      "webhookId": "eadbac33-17b8-44e4-8ff6-5585999d8131",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $now }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla": "menu_agenda",
            "resultado": "cancel -> menú agenda"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25712,
        -8496
      ],
      "id": "944085ba-f083-4b9c-93c6-b8fc059beadc",
      "name": "log de cancelar después de cancelar desde confirmación",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "wz_cita_fecha",
            "paso_actual": "1",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25472,
        -8768
      ],
      "id": "0cc7b439-3ab6-4e26-bcee-871cae034598",
      "name": "actualizar sesión después de editar en confirmación",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Perfecto, reiniciemos la cita desde la fecha.\n\nPaso 1 de 6\n¿Cuál es la fecha de la cita?\nFormato: YYYY-MM-DD\nEjemplo: 2025-12-20\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        25712,
        -8720
      ],
      "id": "2c98c808-83be-420e-9aa4-386d2d19caaa",
      "name": "enviar menú fecha después de editar en confirmación",
      "webhookId": "b4d8623e-6e3b-4132-87f7-fb3c4d692dfb",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "timestamp": "={{ $now }}",
            "resultado": "edit -> reset wizard"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25952,
        -8720
      ],
      "id": "eb71739f-83e5-4ee8-b705-ca19a292cecf",
      "name": "log de editar después de editar desde confirmación",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "019e17c7-5b74-4032-a100-b126b1c7f259",
              "name": "id_cita",
              "value": "={{ $json.id_random }}",
              "type": "string"
            },
            {
              "id": "40556c4f-4472-46ca-8da0-f469e1d5726b",
              "name": "fecha",
              "value": "={{ $json.datos_parciales.split('|')[0].split('=')[1] }}",
              "type": "string"
            },
            {
              "id": "e33c9c59-7778-4ac8-b835-d9fa73defa96",
              "name": "hora",
              "value": "={{ $json.datos_parciales.split('|')[1].split('=')[1] }}",
              "type": "string"
            },
            {
              "id": "59568290-a49b-4238-9584-265a87118cb3",
              "name": "nombre",
              "value": "={{ $json.datos_parciales.split('|')[2].split('=')[1] }}",
              "type": "string"
            },
            {
              "id": "eb69eb51-38ea-41ba-8ee5-cfe712512f57",
              "name": "motivo",
              "value": "={{ $json.datos_parciales.split('|')[3].split('=')[1] }}",
              "type": "string"
            },
            {
              "id": "e783971e-9238-4520-8844-49c3ce2cb725",
              "name": "canal",
              "value": "={{ $json.datos_parciales.split('|')[4].split('=')[1] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        25552,
        -9072
      ],
      "id": "a965f50d-5bab-4a09-93a1-8a80ea0ab79a",
      "name": "normalizar datos_parciales"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_cita": "={{ $json.id_cita }}",
            "fecha": "={{ $json.fecha }}",
            "hora": "={{ $json.hora }}",
            "nombre": "={{ $json.nombre }}",
            "motivo": "={{ $json.motivo }}",
            "canal": "={{ $json.canal }}",
            "estado": "agendada",
            "creado_por": "={{ $('normalización de datos').item.json.telegram_user }}",
            "timestamp_creacion": "={{ $now }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "id_cita",
              "displayName": "id_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha",
              "displayName": "fecha",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "hora",
              "displayName": "hora",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "motivo",
              "displayName": "motivo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "canal",
              "displayName": "canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_creacion",
              "displayName": "timestamp_creacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25792,
        -9008
      ],
      "id": "945e5fc8-04f3-4cbf-9f34-72cc586a07ab",
      "name": "agendar cita",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=¡Listo! Tu cita quedó agendada correctamente ✅\n\nID de la cita: {{ $('agendar cita').item.json.id_cita }}\n\n¿Qué deseas hacer ahora?\n1. Volver a Agenda\n2. Ir al menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        26304,
        -9008
      ],
      "id": "9c3aae3a-5fc1-474b-bfd1-bafe536cbd9e",
      "name": "enviar mensaje de confirmación exitosa",
      "webhookId": "459a58d4-d419-4bf9-b7f5-e66dbe266e3e",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "action": "generate",
        "dataPropertyName": "id_random"
      },
      "type": "n8n-nodes-base.crypto",
      "typeVersion": 1,
      "position": [
        25280,
        -9168
      ],
      "id": "1ecc23b6-54ed-41f9-aa4d-a308a468c812",
      "name": "generar nuevo id para cita"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $now }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla": "menu_agenda",
            "resultado": "ok -> appointment confirmed"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        26560,
        -9008
      ],
      "id": "31a651e6-21c2-4d83-b5e2-37c4972a5e2f",
      "name": "log después de confirmación exitosa",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "success",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        26032,
        -9008
      ],
      "id": "553fddb8-0180-4913-9156-d7ea6182ce02",
      "name": "actualizar sesión a exitos después de confirmar",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "59465d75-b0c5-4e9c-a4bb-bea4a2f33d27",
              "leftValue": "={{ $json.text }}",
              "rightValue": "1",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "5031b0e3-1f8c-49b7-9224-6d75cf733071",
              "leftValue": "={{ $json.text }}",
              "rightValue": "2",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        24832,
        -7776
      ],
      "id": "522cac37-1473-41e9-aa70-3a6d5dd52378",
      "name": "¿acción de salida en citas válida?"
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Ups, esa opción no existe.\n\nOpciones:\n1 volver a agenda\n2 Ir al menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        25056,
        -7584
      ],
      "id": "ee2a2b7f-28f6-4d0d-bf3d-951115e6f7ff",
      "name": "enviar mensaje de opción de acción de salida en citas invalida",
      "webhookId": "f7c270e3-265c-432a-8d69-200b0aa8c8a8",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $now }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla": "menu_agenda",
            "resultado": "failed -> invalid option"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25344,
        -7488
      ],
      "id": "aec0469c-8437-480c-aa73-1d171ef6df68",
      "name": "log de opción de acción de salida en citas invalida",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "77e6c5b1-4dee-45e4-a4c5-377f40bcb3e1"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "22083ef2-8c78-4775-878f-f8441f432b07",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        25088,
        -7872
      ],
      "id": "170f6c51-4704-4109-a23d-91fb54b37c4a",
      "name": "elección de opciones de acción de salida en citas"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_agenda",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25472,
        -8064
      ],
      "id": "a4ae2be6-bbe6-4fc4-923b-174f77416b86",
      "name": "actualizar sesión después de seleccionar acción de menú agenda",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Perfecto, vamos con tu agenda.\n\n¿Qué deseas hacer?\n\n1. Agendar una nueva cita\n2. Consultar tu agenda\n3. Reprogramar una cita\n4. Cancelar una cita\n5. Marcar una cita como completada\n9. Volver al menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        25728,
        -8064
      ],
      "id": "32066a30-8ea9-4f06-8ec9-bc3df7cca9a5",
      "name": "enviar menú agenda después de seleccionar acción de menú agenda",
      "webhookId": "4e30d1e6-83e5-4ae8-826c-f91d5171fe17",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $now }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla": "menu_agenda",
            "opcion_elegida": "={{ $('¿acción de salida en citas válida?').item.json.text }}",
            "resultado": "ok -> menu_agenda"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25936,
        -8064
      ],
      "id": "247c3548-179a-4ad5-933d-a36e22d4d36d",
      "name": "log seleccionar acción de menú agenda",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_principal",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25472,
        -7776
      ],
      "id": "024b13c1-f8c7-4a5a-a033-174dee526550",
      "name": "actualizar sesión después de seleccionar acción de menú principal",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=¿En qué te puedo ayudar hoy?\n\nMenú principal:\n0. Ayuda\n1. Agenda (citas)\n2. Tareas\n3. Recordatorios\n4. Hábitos\n5. Listas\n6. Reportes\n7. Configuración\n8. Administrador",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        25728,
        -7776
      ],
      "id": "b9c2a186-034c-43fd-829e-cd030d56e918",
      "name": "enviar menú agenda después de seleccionar acción de menú principal",
      "webhookId": "e535e5f8-1e35-4dc5-bd7d-f7ad9aabc131",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $now }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla": "menu_principal",
            "opcion_elegida": "={{ $('¿acción de salida en citas válida?').item.json.text }}",
            "resultado": "ok -> main menu"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25936,
        -7776
      ],
      "id": "aaf7a503-65c9-482f-9658-68412d366762",
      "name": "log seleccionar acción de menú principal",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('normalización de datos').item.json.telegram_user }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        24784,
        -13904
      ],
      "id": "92c75952-272b-462a-b66b-440e8b5eee0b",
      "name": "obtener todas las citas por el usuario",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "834685b8-8af1-4777-9e29-93ec18f16d78",
              "leftValue": "={{ $(\"normalizar citas por usuario\").all().length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        25312,
        -14080
      ],
      "id": "da63572c-77e5-464d-832b-5706d68418fd",
      "name": "¿el usuario tiene citas?"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "85bef12d-4ea9-4bf2-8853-4f590699b964",
              "name": "row_number",
              "value": "={{ $json.row_number }}",
              "type": "number"
            },
            {
              "id": "fe2901a3-4b70-4355-8398-793cd3c681e3",
              "name": "id_cita",
              "value": "={{ $json.id_cita }}",
              "type": "string"
            },
            {
              "id": "a2cbe22f-9252-4eb2-bf6f-2525b70079a4",
              "name": "fecha",
              "value": "={{ $json.fecha }}",
              "type": "string"
            },
            {
              "id": "60a2181d-7c2c-4a79-ac74-ad3482f4ea80",
              "name": "hora",
              "value": "={{ $json.hora }}",
              "type": "string"
            },
            {
              "id": "be5eca94-db47-41f9-a20b-8eadae739795",
              "name": "nombre",
              "value": "={{ $json.nombre }}",
              "type": "string"
            },
            {
              "id": "6985458d-2948-45cf-a25f-ab8f002b7048",
              "name": "motivo",
              "value": "={{ $json.motivo }}",
              "type": "string"
            },
            {
              "id": "2ab12dfc-7f1f-4f34-8c78-634e792fadb8",
              "name": "canal",
              "value": "={{ $json.canal }}",
              "type": "string"
            },
            {
              "id": "eadebeb0-d1d2-4b53-bf00-dc252be8d7c3",
              "name": "estado",
              "value": "={{ $json.estado }}",
              "type": "string"
            },
            {
              "id": "00d55685-6b43-43c5-9aa2-9f5b15cabe68",
              "name": "creado_por",
              "value": "={{ $json.creado_por }}",
              "type": "number"
            },
            {
              "id": "676abcf9-f441-4d3f-bd51-0ab11329475d",
              "name": "timestamp_creacion",
              "value": "={{ $json.timestamp_creacion }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        25024,
        -14000
      ],
      "id": "e2fcb83d-2d0d-4d87-b1a5-739db6f47339",
      "name": "normalizar citas por usuario"
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=No tienes citas: {{ $('normalización de datos').item.json.username }}.\n\n¿Qué deseas hacer?\n\n1. Agendar una nueva cita\n2. Consultar tu agenda\n3. Reprogramar una cita\n4. Cancelar una cita\n5. Marcar una cita como completada\n9. Volver al menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        25712,
        -14144
      ],
      "id": "82dfd4ba-a53d-427d-b878-b5a233ecffe3",
      "name": "enviar mensaje cuando el usuario no tiene citas",
      "webhookId": "b3a8625d-68d5-4dc1-9368-5724e164a710",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=📌 {{ $('normalizar citas por usuario').item.json.id_cita }}\n📅 {{ $('normalizar citas por usuario').item.json.fecha }} 🕒 {{ $('normalizar citas por usuario').item.json.hora }}\n👤 {{ $('normalizar citas por usuario').item.json.nombre }}\n📝 {{ $('normalizar citas por usuario').item.json.motivo }}\n📍 {{ $('normalizar citas por usuario').item.json.canal }}\n✅ {{ $('normalizar citas por usuario').item.json.estado }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        25984,
        -14400
      ],
      "id": "71d228dc-7c3e-4b26-b497-5af422e6dc1e",
      "name": "enviar mensaje cuando el paciente tiene citas",
      "webhookId": "80aaca4f-a3b4-4428-ad8c-65e1a01916c4",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=✅ Esas son tus citas.\n\nMenú Agenda:\n1. Agendar una nueva cita\n2. Consultar tu agenda\n3. Reprogramar una cita\n4. Cancelar una cita\n5. Marcar como completada\n9. Volver al menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        26528,
        -14688
      ],
      "id": "9da181fa-c447-43b3-96ac-efae89a442cb",
      "name": "enviar mensaje después de enviar todas las citas del usuario",
      "webhookId": "4f9174af-b30f-49d4-9096-0d56739facb9",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "batchSize": 5,
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        25616,
        -14384
      ],
      "id": "c62da885-b73c-4a0f-8d91-b544592d2fb9",
      "name": "limitar citas del usuario"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "count",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        26144,
        -14608
      ],
      "id": "d46e204d-1cc9-4269-abe8-41e8d15f87dc",
      "name": "agrupar en un solo item final"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $now }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla": "menu_agenda",
            "opcion_elegida": "2",
            "resultado": "listar_citas -> ok"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        26736,
        -14928
      ],
      "id": "095c781b-8d07-42b7-b361-27ec617d088e",
      "name": "log cuando el usuario tiene citas",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $now }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla": "menu_agenda",
            "opcion_elegida": "2",
            "resultado": "listar_citas = 0"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        26224,
        -14192
      ],
      "id": "ee2f9766-7454-45f2-b916-bb637e76f22f",
      "name": "log cuando el usuario no tiene citas",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_principal",
            "paso_actual": "9",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        24720,
        -13296
      ],
      "id": "2f00fe77-c4be-4d3f-bf83-d5312185c02c",
      "name": "actualizar sesión a menu_principal",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=¿En qué te puedo ayudar hoy?\n\nMenú principal:\n0. Ayuda\n1. Agenda (citas)\n2. Tareas\n3. Recordatorios\n4. Hábitos\n5. Listas\n6. Reportes\n7. Configuración\n8. Administrador",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        24928,
        -13200
      ],
      "id": "5b5ec00f-77a6-4c63-8555-ea22ffa1c0f9",
      "name": "enviar mensaje de menú principal",
      "webhookId": "1540459c-cb78-4e7f-b968-1b614607094f",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $now }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla": "menu_princpal",
            "opcion_elegida": "9",
            "resultado": "ok -> menu_principal"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25152,
        -13232
      ],
      "id": "0adfaaa8-a7fa-4549-b176-a4514aeb05c5",
      "name": "log de enviar menu_principal",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_tareas",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -80,
        -3760
      ],
      "id": "d6969958-8c6d-4805-9953-9437cf1a1cc5",
      "name": "actualizar sesión a menú tareas",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Perfecto ✅ vamos con tus tareas.\n\n¿Qué deseas hacer?\n\n1. Crear una nueva tarea\n2. Ver mis tareas\n3. Cambiar estado de una tarea\n9. Volver al menú principal\n\nTip: escribe solo el número.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        128,
        -3984
      ],
      "id": "60dbfe5b-dde8-422d-8777-6437f3649697",
      "name": "mensaje de menú tareas",
      "webhookId": "af47f71c-4da0-4832-8a56-b9e2b3a955fe",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "timestamp": "={{ $now }}",
            "pantalla": "menu_tareas",
            "opcion_elegida": "2",
            "resultado": "ok -> menu_tareas (pedir opción)"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        368,
        -4192
      ],
      "id": "8cf1dbde-aa6a-4406-8576-9fb1c3cd4baa",
      "name": "log de menú tareas",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "3f4d7565-823e-4819-ba21-7ab395df317c",
              "leftValue": "={{ $json.pantalla_actual }}",
              "rightValue": "menu_tareas",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        16,
        -2496
      ],
      "id": "516bb0f1-cbd3-4bb4-8b29-2802d51a7af9",
      "name": "¿estoy en menú tareas?"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "6ed2e480-67bb-4eff-bae4-b881429c926e",
              "leftValue": "={{ $json.text }}",
              "rightValue": "1",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "13dcea7d-9e58-4e89-9457-8d844ac2ab70",
              "leftValue": "={{ $json.text }}",
              "rightValue": "2",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "9101199d-1b38-4baa-a465-fc699bc084d6",
              "leftValue": "={{ $json.text }}",
              "rightValue": "3",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "525f69cb-c6c7-4e6b-b699-6a99ee2b4536",
              "leftValue": "={{ $json.text }}",
              "rightValue": "4",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        352,
        -2448
      ],
      "id": "36bf483f-70f4-4fc9-844b-3d07ac722805",
      "name": "¿opción válida en menú tareas?"
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Ups, esa opción no existe en este menú.\n\nPor favor escribe uno de los números que ves en pantalla.\n\nEstás en: Menú tareas\nOpciones disponibles: 1 al 3, y 9",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        720,
        -2544
      ],
      "id": "3cb11d51-452a-4c54-9149-4340a08706bf",
      "name": "mensaje de opción invalida en menú tareas",
      "webhookId": "7319787d-1561-46c0-bc24-de07ae0e694a",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "20d51df8-9b62-44bb-8b87-0450e1548d04"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "40612cb5-c6e0-4e51-8ced-49a5930cb28d",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "1fa77121-53f5-45c5-8071-d602ec31a61e",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4a12cdad-fc46-4f38-8199-352db9774dde",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        704,
        -2896
      ],
      "id": "da9b9d4d-731c-4cee-aa00-f4e21f813878",
      "name": "opciones de menú tareas"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "wz_tarea_titulo",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        944,
        -3552
      ],
      "id": "d5919e42-3b3e-486f-9fbc-a835df2cadec",
      "name": "actualizar sesión a wz_tarea_titulo",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Escribe el titulo",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1216,
        -3968
      ],
      "id": "2cac550c-3d12-44fd-9895-b7c75231c5ed",
      "name": "enviar mensaje para agregar titulo a la tarea",
      "webhookId": "4360b2ff-60cd-43af-bda8-8d7406903a2a",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "timestamp": "={{ $now }}",
            "pantalla": "menu_tareas",
            "opcion_elegida": "1",
            "resultado": "ok -> menu_agenda (pedir titulo)"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1488,
        -4192
      ],
      "id": "c5e91711-97e0-4cbc-a0bb-f37b676a1baa",
      "name": "log de pedir titulo a tarea",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "wz_cita_fecha",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "03490f30-2a7c-4eb7-bb11-9c8649828df8"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "b746f14e-7063-4c76-91a3-c0374a6a8eeb",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "wz_cita_hora",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "fcf7285b-69d5-4b57-808a-b87bebd910f1",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "wz_cita_nombre",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "712d05d8-b2ca-43a5-8353-e4eb20c5a6c4",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "wz_cita_motivo",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "678235d3-da2e-45fe-81e2-cbcee3d4104b",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "wz_cita_canal",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "e987c246-1a57-429c-964c-e8ecdcadf634",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "wz_cita_confirm",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "51d81d2d-62a0-4aa0-be2a-62a043c58018",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "success",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "08d4f887-2876-457a-aadc-69f93a000200",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "wz_tarea_titulo",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "bc49479c-bddc-4244-aefe-fed76e79ee8e",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "wz_tarea_prioridad",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "b71888e9-4f09-48be-b774-e41eff5f09b1",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "wz_tarea_confirm",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "937e6789-1e56-494f-8853-2f64f1e2d83a",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "wz_habito_nombre",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "f2b017b0-8c04-48ea-8655-bfb178a08bda",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "wz_habito_frecuencia",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "59b4f392-eede-4900-8e59-75d4db6e213d",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "wz_habito_hora",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "374cc9f0-2a5d-430f-b867-88caab446fcd",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "wz_habito_confirm",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "04581b42-8f28-410b-a047-0c68217a1fd0",
                    "leftValue": "={{ $json.pantalla_actual }}",
                    "rightValue": "success_habito",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        1712,
        -4464
      ],
      "id": "8c8c41fc-6d58-40eb-9ff9-05e158854bb6",
      "name": "enrutador wz"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "d8cc030f-8435-4123-98ed-44f157364be3",
              "leftValue": "={{ $('normalización de datos').item.json.text }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        24816,
        -6576
      ],
      "id": "5a532d44-15ec-4659-aa7c-3f161de348cc",
      "name": "¿canceló desde titulo?"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_tareas",
            "paso_actual": "9",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25168,
        -7008
      ],
      "id": "1043a9b8-20b0-4961-b281-7818747cab39",
      "name": "actualizar sesión a menú tareas después de cancelar desde titulo",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Proceso cancelado.\n\n¿Qué deseas hacer?\n\n1. Crear una nueva tarea\n2. Ver mis tareas\n3. Cambiar estado de una tarea\n9. Volver al menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        25424,
        -7008
      ],
      "id": "894c5829-67f7-48a0-b220-05da4a631388",
      "name": "enviar menú tareas después de cancelar después de pedir titulo",
      "webhookId": "1ff2e54f-cf8d-4a51-8e91-796b05531b5f",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "06e5e43a-93ab-4643-a74e-336641f19d16",
              "leftValue": "={{ $('normalización de datos').item.json.text}}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            },
            {
              "id": "3961cf60-25ce-4268-ba63-0b57b64d0436",
              "leftValue": "={{ $('normalización de datos').item.json.text.length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        25056,
        -6624
      ],
      "id": "c51053a1-56e5-4e10-8607-0761518945cd",
      "name": "¿titulo válido?"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "bf036139-b8e9-4cf9-a8ea-3478161783cd",
              "name": "datos_parciales",
              "value": "={{ $('normalización de datos').item.json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        25264,
        -6768
      ],
      "id": "3ae7ee64-4e68-411a-bb3e-ce82cc716022",
      "name": "guardar titulo de tareas en datos_parciales"
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Titulo invalido.\n\nVuélvelo a escribir",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        25392,
        -6560
      ],
      "id": "6bf914fd-94e2-4dcc-bed1-0572ecb15cab",
      "name": "enviar mensaje de titulo invalido",
      "webhookId": "5933270b-71d7-4996-88b1-37f4e66530fe",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "timestamp_ultima_interaccion": "={{ $now }}",
            "datos_parciales": "={{ $json.datos_parciales }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25504,
        -6768
      ],
      "id": "784c99a7-737a-488d-87ef-d0b1ecfaef60",
      "name": "agregar titulo de tarea a datos_parciales",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "wz_tarea_prioridad",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25824,
        -6736
      ],
      "id": "e8d9bb4c-19c7-4fe7-b32d-d407133e4eec",
      "name": "actualizar sesión a wz_tarea_prioridad",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Selecciona una prioridad para tu tarea:\n\n1) Alta\n2) Media\n3) Baja\n\n9) Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        26080,
        -6736
      ],
      "id": "14cd8566-5509-47db-8a0b-e98cfa04e1b0",
      "name": "enviar mensaje de prioridad de tarea",
      "webhookId": "a9a982ed-5540-46c4-8844-471a9f383d46",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1542096762,
          "mode": "list",
          "cachedResultName": "LOGS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1542096762"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "timestamp": "={{ $now }}",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla": "menu_tarea",
            "opcion_elegida": "1",
            "resultado": "ok -> wz_tarea_prioridad"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pantalla",
              "displayName": "pantalla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "opcion_elegida",
              "displayName": "opcion_elegida",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "resultado",
              "displayName": "resultado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        26368,
        -6736
      ],
      "id": "5279f95f-c3c0-40fd-bd9c-84e3757fcb3c",
      "name": "log de pedir prioridad en tarea",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "cdf646b5-fbe1-425f-8bcb-ea8be5c49a12",
              "leftValue": "={{ $json.text }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        25552,
        -6032
      ],
      "id": "d5bed5c2-ad6e-4e6e-a733-2dbbf04a8d33",
      "name": "¿canceló desde prioridad?"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_tarea",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25984,
        -6000
      ],
      "id": "2db10d09-ff7c-40fd-ace4-21db5b8ea901",
      "name": "actualizar sesión a menú tareas después de cancelar desde prioridad",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Proceso cancelado.\n\n¿Qué deseas hacer?\n\n1. Crear una nueva tarea\n2. Ver mis tareas\n3. Cambiar estado de una tarea\n9. Volver al menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        26336,
        -6240
      ],
      "id": "8d48470b-27a4-49af-8d10-921feebc8176",
      "name": "enviar menú tareas después de cancelar después de pedir prioridad",
      "webhookId": "2c91385b-4a52-458f-a1aa-f19d46335305",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "ed3585d8-dea1-41d9-b161-b91d8c9885d0",
              "leftValue": "={{ $json.text }}",
              "rightValue": "1",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "93244a76-5b1a-463f-a9bc-563d1d0c2bad",
              "leftValue": "={{ $json.text }}",
              "rightValue": "2",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "8d8c2b9e-ed42-4c45-b51a-2325059438b6",
              "leftValue": "={{ $json.text }}",
              "rightValue": "3",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        25792,
        -5824
      ],
      "id": "dd061903-d90b-4447-bb8e-e7f17956d327",
      "name": "¿opción validad desde prioridad de tarea?"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "=1",
                    "operator": {
                      "type": "dateTime",
                      "operation": "equals"
                    },
                    "id": "8de350a9-e048-47aa-9fd7-65550cdd4221"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "alta"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "74d8c069-c2f3-401a-b900-6644824d7d58",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "media"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "da4d3469-798a-4191-912f-f8f489245d90",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "baja"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "24134d65-75a1-4c87-ac83-02f5f48d3cdf",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "cancelar"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        26560,
        -5888
      ],
      "id": "b1636362-1557-4e7b-9dfd-b2c6b2243d54",
      "name": "elección de prioridad de tarea"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8bcc59e3-d60e-41b4-9f4d-7269b2b7bcd3",
              "name": "datos_parciales",
              "value": "={{ 'titulo=' + $json.datos_parciales + '|prioridad=media' + '|estado=pendiente' }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        27136,
        -5872
      ],
      "id": "df32be36-e5ac-42ab-bd52-c3d92f8d011c",
      "name": "guardar prioridad media de tarea en datos_parciales"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8bcc59e3-d60e-41b4-9f4d-7269b2b7bcd3",
              "name": "datos_parciales",
              "value": "={{ 'titulo=' + $json.datos_parciales + '|prioridad=alta' + '|estado=pendiente' }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        27136,
        -6064
      ],
      "id": "c066e381-3738-49c9-a2fd-da0cd47ea04b",
      "name": "guardar prioridad alta de tarea en datos_parciales"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8bcc59e3-d60e-41b4-9f4d-7269b2b7bcd3",
              "name": "datos_parciales",
              "value": "={{ 'titulo=' + $json.datos_parciales + '|prioridad=baja' + '|estado=pendiente' }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        27136,
        -5648
      ],
      "id": "1e5f4f38-3977-493a-b22b-46657df2e026",
      "name": "guardar prioridad baja de tarea en datos_parciales"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "datos_parciales": "={{ $json.datos_parciales }}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        27424,
        -5856
      ],
      "id": "c595a7e7-13fa-444a-ad88-90340fe2536d",
      "name": "agregar prioridad media de tarea en datos_parciales",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "datos_parciales": "={{ $json.datos_parciales }}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        27424,
        -6080
      ],
      "id": "938eab05-7e1a-4e19-9e93-4fc6f27d7876",
      "name": "agregar prioridad alta de tarea en datos_parciales",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "datos_parciales": "={{ $json.datos_parciales }}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        27408,
        -5616
      ],
      "id": "fdb2636d-1a3d-4573-8eec-eefaede69d87",
      "name": "agregar prioridad baja de tarea en datos_parciales",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "wz_tarea_confirm",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        27696,
        -6080
      ],
      "id": "5555e050-9e70-4eb5-b4de-8c1e5df8f57f",
      "name": "actualizar sesión a wz_tarea_confirm desde prioridad alta tarea",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "wz_tarea_confirm",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        27696,
        -5856
      ],
      "id": "42b60274-f7f6-4a43-8cde-82b7db583670",
      "name": "actualizar sesión a wz_tarea_confirm desde prioridad media tarea",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "wz_tarea_confirm",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        27696,
        -5616
      ],
      "id": "3e307c8b-88e3-40e6-bb98-7b4bc9e601a4",
      "name": "actualizar sesión a wz_tarea_confirm desde prioridad baja tarea",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Tarea:\n\n{{ $('guardar prioridad media de tarea en datos_parciales').item.json.datos_parciales }}\n\n¿Desas confirmar?\n\n1) Confirmar\n2) Editar\n\n9) Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        28128,
        -5856
      ],
      "id": "838d016d-c316-4056-9e7c-8add7c1557d0",
      "name": "enviar mensaje de confirmación de tarea desde prioridad",
      "webhookId": "5ae2eca3-40fb-4626-a2b7-241ba9f68ef2",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Ups, está opción no existe.\n\nOpciones validas del 1 al 3 y 9",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        26256,
        -5728
      ],
      "id": "4e0e4595-f297-4192-acc1-4af0a4377b21",
      "name": "enviar mensaje de opción invalida en prioridades de tarea",
      "webhookId": "dd477521-7a14-4e13-9d3a-1a8d9fc02f21",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_tareas",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        27136,
        -5408
      ],
      "id": "fc3158a5-54ff-47f9-a195-ba142ce63262",
      "name": "actualizar sesión desde prioridad de tarea después de cancelar",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Proceso cancelado.\n\n¿Qué deseas hacer?\n\n1. Crear una nueva tarea\n2. Ver mis tareas\n3. Cambiar estado de una tarea\n9. Volver al menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        27344,
        -5408
      ],
      "id": "b13b40b2-03ad-4724-8c53-5da9867e1027",
      "name": "enviar menú tarea después de cancelar desde prioridad de tarea",
      "webhookId": "fb661ee5-b0cd-4229-9942-d8da4c404726",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "e8597434-c3e2-4f4c-b9ef-e12aa6c14765",
              "leftValue": "={{ $json.text }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        26496,
        -5072
      ],
      "id": "2ceeacbe-2f5c-4bad-9fd2-86e13f17ec65",
      "name": "¿canceló desde confirmar?"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_tarea",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        26864,
        -5040
      ],
      "id": "50fed000-7b3f-4ce3-b00c-38cf4cabf067",
      "name": "actualizar sesión a menú tareas después de cancelar desde confirmar",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Proceso cancelado.\n\n¿Qué deseas hacer?\n\n1. Crear una nueva tarea\n2. Ver mis tareas\n3. Cambiar estado de una tarea\n9. Volver al menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        27376,
        -4672
      ],
      "id": "927a8b10-d4b3-46c6-9e6f-82755f4a7fd5",
      "name": "enviar menú tareas después de cancelar después de pedir confirmar",
      "webhookId": "2c91385b-4a52-458f-a1aa-f19d46335305",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "d0303d77-86e2-4b10-8fcc-303c756b39f1",
              "leftValue": "",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        26864,
        -4800
      ],
      "id": "e0005512-c3b5-49c6-889d-ccf35a32c96d",
      "name": "¿opción valida desde confirmar tarea?"
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Ups, está opción no existe.\n\nOpciones validas del 1, 2 y 9",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        27648,
        -4080
      ],
      "id": "858d2c82-59b1-4c97-90f6-577a189cf29f",
      "name": "enviar mensaje de opción invalida en confirmación de tarea",
      "webhookId": "dd477521-7a14-4e13-9d3a-1a8d9fc02f21",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('enrutador wz').item.json.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "8c369866-2ec8-413b-b821-cf33653cf7a3"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "confirmar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "2cbfa3b5-cad8-4282-b105-d480cf57cda8",
                    "leftValue": "={{ $('enrutador wz').item.json.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "editar"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        27568,
        -4368
      ],
      "id": "8d445274-3ab3-49e2-9011-eb72679e9851",
      "name": "elección de confirmar tarea"
    },
    {
      "parameters": {
        "action": "generate",
        "dataPropertyName": "tarea_id"
      },
      "type": "n8n-nodes-base.crypto",
      "typeVersion": 1,
      "position": [
        28032,
        -4640
      ],
      "id": "2137eb56-db8c-4e5a-9cfc-8a10d88d48c6",
      "name": "generar nuevo id para tarea"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "wz_tarea_titulo",
            "paso_actual": "1",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        28080,
        -4112
      ],
      "id": "7cd82625-9487-457e-a38b-b6bf8c77230e",
      "name": "actualizar sesión a editar después de la elección desde confirmar",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "Escribe el titulo",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        28368,
        -4048
      ],
      "id": "2f6c9f42-1647-4a3b-89c3-f19216e358b9",
      "name": "enviar mensaje después de editar tarea en opciones de confirmar",
      "webhookId": "b2ffa2b1-e3ed-43ea-9fe4-ebbbc5077320",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e58d2a6c-d35a-4cb6-9995-a3ccbcb1ef43",
              "name": "tarea_id",
              "value": "={{ $json.tarea_id }}",
              "type": "string"
            },
            {
              "id": "7ddcf5e8-8609-46cf-8a3e-caf4f83656a4",
              "name": "titulo",
              "value": "={{ $('elección de confirmar tarea').item.json.datos_parciales.split('|')[0].split('=')[1] }}",
              "type": "string"
            },
            {
              "id": "0195bf18-b604-43df-8eab-a4f58f42b1f4",
              "name": "prioridad",
              "value": "={{ $json.datos_parciales.split('|')[1].split('=')[1] }}",
              "type": "string"
            },
            {
              "id": "4b4e56c4-515b-4bca-8d92-3723910b61ec",
              "name": "estado",
              "value": "={{ $json.datos_parciales.split('|')[2].split('=')[1] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        28448,
        -4304
      ],
      "id": "b1db44a0-faaf-4b77-acb7-4dba818eed6c",
      "name": "normalizar datos_parciales1"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 700355058,
          "mode": "list",
          "cachedResultName": "TAREAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=700355058"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_tarea": "={{ $json.tarea_id }}",
            "titulo": "={{ $json.titulo }}",
            "prioridad": "={{ $json.prioridad }}",
            "estado": "={{ $json.estado }}",
            "fecha_objetivo": "2027-01-01",
            "creado_por": "={{ $('normalización de datos').item.json.telegram_user }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "id_tarea",
              "displayName": "id_tarea",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "titulo",
              "displayName": "titulo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "prioridad",
              "displayName": "prioridad",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_objetivo",
              "displayName": "fecha_objetivo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        28736,
        -4288
      ],
      "id": "0ec4e759-dc33-47c4-8bc9-df5bb8bdc445",
      "name": "crear tarea",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "datos_parciales": "{}",
            "paso_actual": "0",
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_tareas",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        29040,
        -4288
      ],
      "id": "46fddb80-4fb6-4448-bb02-f78925d06111",
      "name": "actualizar sesión después de crear tarea",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=¿Qué deseas hacer?\n\n1. Crear una nueva tarea\n2. Ver mis tareas\n3. Cambiar estado de una tarea\n9. Volver al menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        29360,
        -4304
      ],
      "id": "09a2959e-0769-416b-a8fe-ba8d293677e9",
      "name": "enviar menú tareas después de confirmar tarea",
      "webhookId": "2de10b6e-9f2c-45f5-b3d8-06ee29576693",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 700355058,
          "mode": "list",
          "cachedResultName": "TAREAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=700355058"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('normalización de datos').item.json.telegram_user }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1344,
        -2864
      ],
      "id": "1bf055d4-df8b-425a-98c1-0d382bb1a22e",
      "name": "obtener todas las tareas por el usuario",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1eddadb4-066b-432f-b9b5-561d30f0ca59",
              "name": "id_tarea",
              "value": "={{ $json.id_tarea }}",
              "type": "string"
            },
            {
              "id": "2ff9e41a-ab28-46bf-87c1-aa17d1b4f11f",
              "name": "titulo",
              "value": "={{ $json.titulo }}",
              "type": "string"
            },
            {
              "id": "1c65c70c-5191-4a8e-aa89-07c5800ccb64",
              "name": "prioridad",
              "value": "={{ $json.prioridad }}",
              "type": "string"
            },
            {
              "id": "59873987-a4c8-457e-82a4-1be4b2367cd8",
              "name": "estado",
              "value": "={{ $json.estado }}",
              "type": "string"
            },
            {
              "id": "957a22b3-9ac4-4813-a38f-a797dce37496",
              "name": "fecha_objetivo",
              "value": "={{ $json.fecha_objetivo }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1584,
        -2784
      ],
      "id": "ea72a57a-d57a-4680-9bd7-94f6f9891d32",
      "name": "normalizar tareas por usuarios"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "5d8e5027-4074-46c6-96f4-ac63abf3fa28",
              "leftValue": "={{ $(\"normalizar tareas por usuarios\").all().length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        1936,
        -2752
      ],
      "id": "c6e88995-2a9e-41f7-9e90-98fa3a965153",
      "name": "¿el usuario tiene tareas?"
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Este usuario tiene 0 tareas",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2304,
        -2528
      ],
      "id": "411e907c-35f2-4980-b1e7-228e76bf4403",
      "name": "enviar mensaje cuando el usuario no tiene tareas",
      "webhookId": "7b6727ce-3525-4fce-8f19-1406ba96f4b4",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "batchSize": 5,
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        2256,
        -2832
      ],
      "id": "63b37add-04df-4e1a-896e-e4df76f0fcc1",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=🆔 {{ $('normalizar tareas por usuarios').item.json.id_tarea }}\n✅ {{ $('normalizar tareas por usuarios').item.json.titulo }}\n📈 {{ $('normalizar tareas por usuarios').item.json.prioridad }}\n🆗 {{ $('normalizar tareas por usuarios').item.json.estado }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2768,
        -2208
      ],
      "id": "56c7e28d-6e66-40d2-bc82-f7c5ad7cc23c",
      "name": "enviar mensaje cuando el usuario tiene tareas",
      "webhookId": "e3d257fd-dd48-45f4-9820-82dafac9e269",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "count",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2688,
        -2624
      ],
      "id": "46023658-b3e6-445f-836b-5298cd617e78",
      "name": "agrupar en un solo item las tareas"
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=✅ Esas son tus citas.\n\nMenú Tareas:\n1. Crear una tarea\n2. Ver todas las tareas\n3. Cambiar estado por tarea\n\n9. Menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3136,
        -2272
      ],
      "id": "974ffc2f-7c43-4833-adaf-950225318912",
      "name": "enviar mensaje después de enviar todas las tareas por el usuario",
      "webhookId": "7728c94f-0e67-4b6d-9236-16a19fb21357",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_tareas",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2912,
        -2464
      ],
      "id": "73abc482-2a24-4ced-a87d-3751914450b9",
      "name": "actualizar sesión a menú tareas desde ver tareas",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_habitos",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -96,
        -3392
      ],
      "id": "a0404d77-0681-4a86-a0de-f6abcb93c1be",
      "name": "actualizar sesión a menú habitos",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Menú habitos\n\n1) Crear habito.\n2) Listar habitos.\n\n9) Menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        240,
        -3664
      ],
      "id": "9a2a93d3-dfb6-442f-affd-51e45ef3078b",
      "name": "enviar mensaje de menú habitos",
      "webhookId": "5c38a19b-f912-49e5-9501-b936c5b8a987",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "ee2ef54d-759c-40ca-93a1-b0715d6f3201",
              "leftValue": "={{ $('normalizar sesión actual').item.json.pantalla_actual }}",
              "rightValue": "menu_habitos",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -224,
        -1840
      ],
      "id": "16e2b52e-641f-410a-b90c-19dc0fb510b6",
      "name": "¿estoy en menú habitos?"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "f0727ed6-e544-4a5a-9f90-4ba37e10e3d7",
              "leftValue": "",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        160,
        -1808
      ],
      "id": "217fce59-64fb-4d36-886f-4309bba24ceb",
      "name": "¿opción válida en menú habitos?"
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Ups, esa opción no existe en este menú.\n\nPor favor escribe uno de los números que ves en pantalla.\n\nEstás en: Menú habitos\nOpciones disponibles: 1, 2 y 9",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        624,
        -1696
      ],
      "id": "4d54ce81-9328-48a9-956f-82183ee22885",
      "name": "mensaje de opción invalida en menú habitos",
      "webhookId": "7319787d-1561-46c0-bc24-de07ae0e694a",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "54515f5f-0365-4eec-8a16-a475368aab9a"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "62b38932-9dd9-48f9-969a-557a88925755",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "a3045d82-0f49-4fcd-bef5-27f008e2fb67",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        480,
        -2016
      ],
      "id": "fb82f894-afd2-4ff7-90fc-4f271617a8c0",
      "name": "opciones menú habitos"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_principal",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        800,
        -1888
      ],
      "id": "e7879750-180b-4ca6-b2b5-22581a8b82e3",
      "name": "actualizar sesión a menú principal con opción en menú habitos",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=¿En qué te puedo ayudar hoy?\n\nMenú principal:\n0. Ayuda\n1. Agenda (citas)\n2. Tareas\n3. Recordatorios\n4. Hábitos\n5. Listas\n6. Reportes\n7. Configuración\n8. Administrador",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1088,
        -1792
      ],
      "id": "d5e774eb-e091-4776-b358-0c1d56b4d8ae",
      "name": "enviar menú principal desde menú habitos",
      "webhookId": "4a30d4f5-5c87-44a1-b738-69c4a786d1b3",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1940535612,
          "mode": "list",
          "cachedResultName": "HABITOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1940535612"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "creado_por",
              "lookupValue": "={{ $('normalización de datos').item.json.telegram_user }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1008,
        -2080
      ],
      "id": "0cffcf38-431f-4101-ac5c-d53811de3f53",
      "name": "obtener todos los habitos del usuario",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "wz_habito_nombre",
            "paso_actual": "1",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        736,
        -2240
      ],
      "id": "f43b2133-e1aa-49fb-ba2f-0d412b8b6275",
      "name": "actualizar sesión a wz_habito_nombre",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Escribe el nombre\n\n9) Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        992,
        -2384
      ],
      "id": "516dd809-a63c-4fa3-b313-8cf873cd72fe",
      "name": "enviar mensaje para añadir nombre a habito",
      "webhookId": "6a41e59e-0dfb-4ed8-a93b-0ccbed42d682",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "2935d95f-db89-4b84-b7ce-4d6c06c35166",
              "leftValue": "={{ $json.text }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        26752,
        -4608
      ],
      "id": "906e60d2-d080-4b7d-9e2c-7022b0e2b08a",
      "name": "¿canceló desde nombre de habito?"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_habitos",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        27008,
        -4592
      ],
      "id": "4400f2f3-7594-47b3-82a2-3d5cbe5d92f6",
      "name": "actualizar sesión a menú habito después de cancelar desde nombre de habito",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Proceso cancelado.\n\n¿Qué deseas hacer?\n\n1. Crear un nuevo habito\n2. Ver mis habitos\n\n9. Volver al menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        27376,
        -3920
      ],
      "id": "24bfa57e-3ae6-420c-85dc-bbb14ec49315",
      "name": "enviar menú habitos después de cancelar después de pedir nombre de habito",
      "webhookId": "2c91385b-4a52-458f-a1aa-f19d46335305",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "06e5e43a-93ab-4643-a74e-336641f19d16",
              "leftValue": "={{ $('normalización de datos').item.json.text}}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            },
            {
              "id": "3961cf60-25ce-4268-ba63-0b57b64d0436",
              "leftValue": "={{ $('normalización de datos').item.json.text.length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        27216,
        -3328
      ],
      "id": "faf6b859-e5d0-4dfe-8716-302ea2208ee9",
      "name": "¿nombre de habito válido?"
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Nombre invalido.\n\nVuélvelo a escribir",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        27552,
        -3264
      ],
      "id": "6142c28f-161e-4b21-9125-6b3d5179c4b2",
      "name": "enviar mensaje de nombre de habito invalido",
      "webhookId": "5933270b-71d7-4996-88b1-37f4e66530fe",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "bf036139-b8e9-4cf9-a8ea-3478161783cd",
              "name": "datos_parciales",
              "value": "={{ 'nombre=' + $('normalización de datos').item.json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        27424,
        -3472
      ],
      "id": "9e60bb19-59ad-478b-aefb-972578f85177",
      "name": "guardar nombre de habito en datos_parciales"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "timestamp_ultima_interaccion": "={{ $now }}",
            "datos_parciales": "={{ $json.datos_parciales }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        27664,
        -3472
      ],
      "id": "5cd6fedd-fb0b-4e91-9535-8089c99a1b1b",
      "name": "agregar nombre de habitoa datos_parciales",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "wz_habito_frecuencia",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        27984,
        -3440
      ],
      "id": "d8d43d51-93f9-4221-b4d4-e1f7dbbad54f",
      "name": "actualizar sesión a wz_habito_frecuencia",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Selecciona la frecuencia para tu habito:\n\n1) Alta\n2) Baja\n\n9) Cancelar",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        28240,
        -3440
      ],
      "id": "c4eacb1b-8635-4669-a344-25dee67775cf",
      "name": "enviar mensaje de frecuencia de habito",
      "webhookId": "a9a982ed-5540-46c4-8844-471a9f383d46",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "a552cb2d-e16d-4ed8-bb6f-9c5ad4457d84",
              "leftValue": "={{ $json.text }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        25072,
        -4336
      ],
      "id": "fb12bb1f-1a6c-471a-aa74-4a4c416c62b6",
      "name": "¿canceló desde frecuencia?"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_habitos",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        26432,
        -4496
      ],
      "id": "6941b0f9-ea5b-4b0e-9e98-aaf06c20c606",
      "name": "actualizar sesión a menú habito después de cancelar desde frecuencia de habito",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Proceso cancelado.\n\n¿Qué deseas hacer?\n\n1. Crear un nuevo habito\n2. Ver mis habitos\n\n9. Volver al menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        26704,
        -4400
      ],
      "id": "2d443599-3c65-437e-8644-6de249d43b26",
      "name": "enviar menú habitos después de cancelar después de pedir frecuencia de habito",
      "webhookId": "2c91385b-4a52-458f-a1aa-f19d46335305",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "34329bd1-0aab-4218-afc3-c2c04d49acbb",
              "leftValue": "={{ $json.text }}",
              "rightValue": "1",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "5f7bdd5a-03c8-4ba7-a84d-2de3bd835b19",
              "leftValue": "={{ $json.text }}",
              "rightValue": "2",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "23151b4f-c7f6-4179-b52f-187d2e9a3a28",
              "leftValue": "={{ $json.text }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        25280,
        -3488
      ],
      "id": "f436ddd6-33a3-4228-b7ea-24bc8e210ed2",
      "name": "¿opción valida en frecuencia de habito?"
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Ups, está opción no existe.\n\nOpciones validas del 1, 2 y 9",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        25520,
        -3568
      ],
      "id": "0935cf01-aabb-4161-95a2-ac4b857a8297",
      "name": "enviar mensaje de opción invalida en frecuencia de habito",
      "webhookId": "dd477521-7a14-4e13-9d3a-1a8d9fc02f21",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "c3a91d96-7d5e-4525-b8b7-0db58671aff6"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "alta"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "0f3f7a5b-7d41-47e5-93a1-94f4c0072070",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "baja"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        25424,
        -4016
      ],
      "id": "8b0a763a-f17b-4cbc-a307-470152d9e3ca",
      "name": "elección de frecuencia de habito"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "07c7e236-202a-4318-ba0e-12dc66212a61",
              "name": "datos_parciales",
              "value": "={{ $json.datos_parciales + '|frecuencia=alta'}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        25680,
        -4288
      ],
      "id": "fcb057a0-fe2c-4ad9-8a91-59b9b92abcbd",
      "name": "guardar frecuencia alta en datos_parciales"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3eea4c6d-12e5-4dc9-9e81-05510d9a3575",
              "name": "datos_parciales",
              "value": "={{ $json.datos_parciales + '|frecuencia=baja'}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        25680,
        -3792
      ],
      "id": "12ae5ec6-00ad-464e-8fdd-c664a6dc04a6",
      "name": "guardar frecuencia baja en datos_parciales"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "datos_parciales": "={{ $json.datos_parciales }}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        26080,
        -4160
      ],
      "id": "a1dbee96-a3fd-436c-be7e-ec7e9e877038",
      "name": "agregar frecuencia alta en datos_parciales",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "datos_parciales": "={{ $json.datos_parciales }}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        25952,
        -3632
      ],
      "id": "8901c874-f608-41bb-92d8-6855af5645f3",
      "name": "agregar frecuencia baja en datos_parciales",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "wz_habito_hora",
            "paso_actual": "3",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        26352,
        -4160
      ],
      "id": "56fbb0ce-5830-45b6-a426-a8e0c6333e92",
      "name": "actualizar sesión a wz_habito_hora desde frecuencia alta",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "wz_habito_hora",
            "paso_actual": "3",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        26160,
        -3632
      ],
      "id": "eb9575ec-114c-487d-9459-f322e72382d0",
      "name": "actualizar sesión a wz_habito_hora desde frecuencia baja",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=¿A qué hora será? HH:MM (24h) Ej: 14:30\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        26560,
        -4160
      ],
      "id": "d468d1be-97af-4718-b8f2-cd0f3389b557",
      "name": "enviar mensaje de hora habito desde frecuencia alta",
      "webhookId": "68b7966c-6171-4ee4-9850-8e3c91c0cb37",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=¿A qué hora será? HH:MM (24h) Ej: 14:30\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        26400,
        -3632
      ],
      "id": "78e3d507-f738-490c-9aec-b7807bf6f2f5",
      "name": "enviar mensaje de hora habito desde frecuencia baja",
      "webhookId": "68b7966c-6171-4ee4-9850-8e3c91c0cb37",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "f8180dd6-b7a4-49d6-8bac-615812a0ea6b",
              "leftValue": "={{ $('¿estoy en menú agenda?').item.json.text }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        23472,
        -4208
      ],
      "id": "4ff95e91-ffe2-4d91-abb7-d51b5b638bd0",
      "name": "¿canceló desde hora de habito?"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_habito",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        24480,
        -4224
      ],
      "id": "ef92bea6-7aed-4bdb-a3e9-301ab9dea070",
      "name": "actualizar sesión a menú habitos desde cancelar en hora habito",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Proceso cancelado.\n\n¿Qué deseas hacer?\n\n1. Crear un nuevo habito\n2. Ver mis habitos\n\n9. Volver al menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        24800,
        -4208
      ],
      "id": "1e81378d-4d55-4b11-b23c-2db8de65c3aa",
      "name": "enviar mensaje de cancelar desde hora de habito",
      "webhookId": "3b651204-2614-42b8-b0e0-65857fb90e91",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "26246d78-2e34-49a3-b4ad-cdd28a7ef21f",
              "leftValue": "={{ $json.text }}",
              "rightValue": "^([01]\\d|2[0-3]):[0-5]\\d$",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        23760,
        -4000
      ],
      "id": "9816be5f-3c6f-471d-aaa3-bca925ba0a91",
      "name": "¿hora de habito válida?"
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Ups, la hora que escribiste es invalida.\n\nFormato HH:MM (24h)",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        23952,
        -3712
      ],
      "id": "4c983f25-a1bb-44b9-927d-3963a6a72b2b",
      "name": "enviar mensaje de hora de habito invalida",
      "webhookId": "a862a8b6-be82-4ef3-bd7a-a5c50e150105",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "dba4b239-a38c-483e-a9e9-d2b9e4a2dce4",
              "name": "datos_parciales",
              "value": "={{ $json.datos_parciales + '|hora=' + $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        24064,
        -4016
      ],
      "id": "dd72d51c-87cf-47df-a0ee-c9caeac0b131",
      "name": "guardar hora de habito en datos_parciales"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "datos_parciales": "={{ $json.datos_parciales }}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        24304,
        -3984
      ],
      "id": "edf3dafb-02bb-4eb2-ad90-337e6f0f8be4",
      "name": "agregar hora de habito en datos_parciales",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "wz_habito_confirm",
            "paso_actual": "4",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        24576,
        -3984
      ],
      "id": "324a54b1-b648-4843-9971-1ca61ea6680c",
      "name": "actualizar sesión a wz_habito_confirm",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Listo, ya es hora de confirmar el habito.\n\n{{ $('guardar hora de habito en datos_parciales').item.json.datos_parciales }}\n\n1. Confirmar\n2. Editar\n\n9. Cancelar",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        24784,
        -3984
      ],
      "id": "e9c9ab79-6476-481f-8438-98b513642299",
      "name": "enviar mensaje de confirmar desde hora habito",
      "webhookId": "c44f2fa4-0b4d-4713-b5c8-f0d905ebc65f",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8a39892a-4fde-4f24-9cef-ba451023822c",
              "leftValue": "",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        21200,
        -4048
      ],
      "id": "f04c088b-983f-41b4-a339-2baec4a8dfdc",
      "name": "¿opción valida de confirmación desde habito?"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "c5a3e79f-d485-4ba3-bab5-e77bf63135a3"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "confirmar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "491fe949-c720-478c-8c48-fae8f560970d",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "editar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "1205ebd4-e5c1-4bce-8968-a395f7af69c4",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "9",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "cancelar"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        21712,
        -4048
      ],
      "id": "2ebfb055-f1e1-4b6b-8c51-0d3f3faea106",
      "name": "elección de confirmación desde habito"
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Ups, esta opción en confirmación es invalida.\n\nLas opciones validas son 1, 2 y 9.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        21456,
        -3888
      ],
      "id": "7360338b-fb8b-470f-8fd9-c8fb00b8b1d7",
      "name": "enviar mensaje de opción invalida desde confirmación de habito",
      "webhookId": "3266529d-f402-4be0-9030-72ca25b993f5",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "action": "generate",
        "dataPropertyName": "id_habito"
      },
      "type": "n8n-nodes-base.crypto",
      "typeVersion": 1,
      "position": [
        22208,
        -4096
      ],
      "id": "3fc18047-b2cf-4e68-9a89-58f5741f387b",
      "name": "generar nuevo id para habito"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e64dbceb-04f6-4d49-91af-384319b0cb77",
              "name": "id_habito",
              "value": "={{ $json.id_habito }}",
              "type": "string"
            },
            {
              "id": "1e8b2fba-c869-4db5-aaef-3ef0eb9cc055",
              "name": "nombre",
              "value": "={{ $json.datos_parciales.split('|')[0].split('=')[1] }}",
              "type": "string"
            },
            {
              "id": "29b07b97-f8ee-444d-b83b-1b13de7e0782",
              "name": "frecuencia",
              "value": "={{ $json.datos_parciales.split('|')[1].split('=')[1] }}",
              "type": "string"
            },
            {
              "id": "746329a4-119e-4285-ae87-d29682d97fd3",
              "name": "hora",
              "value": "={{ $json.datos_parciales.split('|')[2].split('=')[1] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        22528,
        -4064
      ],
      "id": "b4abbe89-91af-40e8-9580-4701c41792ef",
      "name": "normalizar datos_parciales de habito"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1940535612,
          "mode": "list",
          "cachedResultName": "HABITOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=1940535612"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_habito": "={{ $json.id_habito }}",
            "nombre": "={{ $json.nombre }}",
            "frecuencia": "={{ $json.frecuencia }}",
            "hora_recordatorio": "={{ $json.hora }}",
            "estado": "pendiente",
            "creado_por": "={{ $('normalización de datos').item.json.telegram_user }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "id_habito",
              "displayName": "id_habito",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "frecuencia",
              "displayName": "frecuencia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "hora_recordatorio",
              "displayName": "hora_recordatorio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "creado_por",
              "displayName": "creado_por",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        22864,
        -4032
      ],
      "id": "f1d3f25d-4879-42f5-8d0d-ae8409fbdae7",
      "name": "crear habito",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "success_habito",
            "paso_actual": "5",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        23120,
        -4032
      ],
      "id": "8dead9ba-5b62-4f25-aea8-67df11dac193",
      "name": "actualizar sesión a exitos después de confirmar habito",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=¡Listo! Tu cita quedó agendada correctamente ✅\n\nID de habito: {{ $('crear habito').item.json.id_habito }}\n\n¿Qué deseas hacer ahora?\n1. Volver a Habito\n2. Ir al menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        23408,
        -3856
      ],
      "id": "22d0dd85-7d64-42fe-981b-fa69f99ed779",
      "name": "enviar mensaje de confirmación exitosa de habito",
      "webhookId": "f444d7dc-e7f9-4524-8d26-0017d4fd3ef8",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "wz_habito_nombre",
            "paso_actual": "1",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        22208,
        -3856
      ],
      "id": "228fe811-d05f-480f-83a5-e631c2adf01c",
      "name": "actualizar sesión después de editar en habitos",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Escribe el nombre:",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        22560,
        -3840
      ],
      "id": "95bb6b73-ce07-4bf0-afd0-177827663727",
      "name": "enviar menú nombre después de editar en habitos",
      "webhookId": "1699a043-4286-4e58-af6f-5f8d29aa447d",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_habitos",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        22208,
        -3600
      ],
      "id": "3656c4ee-499f-476e-9f1f-c797153d7e9e",
      "name": "actualizar sesión después de cancelar en habitos",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Proceso cancelado.\n\n¿Qué deseas hacer?\n\n1. Crear un nuevo habito\n2. Ver mis habitos\n\n9. Volver al menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        22576,
        -3584
      ],
      "id": "ac8af4e3-d534-4a02-bf10-bdc5ac1c6dde",
      "name": "enviar menú habitos después de cancelar",
      "webhookId": "0ce6611e-5fa5-4a6f-931d-1da9b1220aaa",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "ebfeda49-0cc1-4d11-aa36-cf2f4084d127",
              "leftValue": "={{ $json.text }}",
              "rightValue": "1",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "68464de2-be4d-408d-81bc-4280137c4d86",
              "leftValue": "={{ $json.text }}",
              "rightValue": "2",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        20672,
        -3792
      ],
      "id": "ab8799d6-a7d4-43d5-8be5-e0dd612a9f09",
      "name": "¿opción invalida en éxito?"
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Ups, esta opción es invalida.\n\nOpciones validas: 1 y 2",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        20848,
        -3536
      ],
      "id": "b588bff6-d035-4877-8f43-0dfc3f4d2db0",
      "name": "enviar mensaje de opción invalida desde éxito",
      "webhookId": "77d4f85c-499e-4ec9-854d-97748731f090",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "db1e96c6-02ee-46f7-a485-2660bc67dc97"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "24de97eb-eea3-417d-a13a-9155c1d11bec",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        21200,
        -3584
      ],
      "id": "314e0fad-365d-4117-9921-74bf1301a06a",
      "name": "elección de opciones de acción de salida en habitos"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_habitos",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        21488,
        -3664
      ],
      "id": "1534642d-ff90-4ad5-9400-4e330654b2b9",
      "name": "actualizar sesión después de seleccionar menú habito",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Proceso cancelado.\n\n¿Qué deseas hacer?\n\n1. Crear un nuevo habito\n2. Ver mis habitos\n\n9. Volver al menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        21744,
        -3696
      ],
      "id": "7355ea0c-6d92-464a-988f-333b441bf5fb",
      "name": "enviar menú habitos desde opción menú habito",
      "webhookId": "9b1ac17c-06aa-4804-a9ec-eacd23221f6d",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_principal",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        21472,
        -3392
      ],
      "id": "fe9d2a41-e23c-4519-9b4d-9cd27fd8b5cb",
      "name": "actualizar sesión después de seleccionar menú principal",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=¿En qué te puedo ayudar hoy?\n\nMenú principal:\n0. Ayuda\n1. Agenda (citas)\n2. Tareas\n3. Recordatorios\n4. Hábitos\n5. Listas\n6. Reportes\n7. Configuración\n8. Administrador",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        21680,
        -3392
      ],
      "id": "9d92240b-9542-4726-9d9b-a3177259af32",
      "name": "enviar menú principal desde opción menú habito",
      "webhookId": "5d515a3e-1d50-401a-82f5-cc3a63b7813a",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e8e62fd8-e6aa-4838-8ae3-429bc6ee78e5",
              "name": "id_habito",
              "value": "={{ $json.id_habito }}",
              "type": "string"
            },
            {
              "id": "0c1a276d-b7c3-494f-97e8-199fca1fb755",
              "name": "nombre",
              "value": "={{ $json.nombre }}",
              "type": "string"
            },
            {
              "id": "d0116dfa-b952-4c0f-8fd9-896ebee613c0",
              "name": "frecuencia",
              "value": "={{ $json.frecuencia }}",
              "type": "string"
            },
            {
              "id": "c975ea80-1c1b-435b-8b6f-ecedb5c9c71a",
              "name": "hora_recordatorio",
              "value": "={{ $json.hora_recordatorio }}",
              "type": "string"
            },
            {
              "id": "319f8f07-ee3c-4dbe-b036-b2df98d5251d",
              "name": "estado",
              "value": "={{ $json.estado }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1264,
        -2192
      ],
      "id": "786c81ac-2dcf-4ba4-8531-50c8f9c2c234",
      "name": "normalizar todos los habitos"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "30c15171-c680-4c34-83a5-4aeec30d7493",
              "leftValue": "={{ $(\"normalizar todos los habitos\").all().length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        1440,
        -2352
      ],
      "id": "dacbaf7e-2212-4749-8ff1-07eb3c185a67",
      "name": "¿el usuario tiene habitos?"
    },
    {
      "parameters": {
        "batchSize": 5,
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        2112,
        -1952
      ],
      "id": "6979196d-9872-4516-82bd-5c56b2eaf568",
      "name": "Loop Over Items1"
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Este usuario tiene 0 habitos",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1680,
        -1696
      ],
      "id": "c0fed3dc-e485-45c4-9620-2b76e7cc2479",
      "name": "enviar mensaje cuando el usuario no tiene habitos",
      "webhookId": "7b6727ce-3525-4fce-8f19-1406ba96f4b4",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "count",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2544,
        -1744
      ],
      "id": "e929cef4-6b29-47c2-91ea-0597fe6c1820",
      "name": "agrupar en un solo item los habitos"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_habitos",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2768,
        -1584
      ],
      "id": "63fe35c3-944e-4996-ae6e-01834b73293d",
      "name": "actualizar sesión a menú habitos desde ver habitos",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=✅ Esas son tus citas.\n\nMenú Tareas:\n1. Crear un habito\n2. Ver todos los habitos\n\n9. Menú principal",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3008,
        -1360
      ],
      "id": "7bebf00a-f579-4e65-8f35-9ccb79d569d5",
      "name": "enviar mensaje después de enviar todos los habitos por el usuario",
      "webhookId": "7728c94f-0e67-4b6d-9236-16a19fb21357",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=🆔 {{ $('normalizar todos los habitos').item.json.id_habito }}\n{{ $('normalizar todos los habitos').item.json.nombre }}\n{{ $json.frecuencia }}\n{{ $('normalizar todos los habitos').item.json.hora_recordatorio }}\n{{ $('normalizar todos los habitos').item.json.estado }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2624,
        -1328
      ],
      "id": "20f58e32-3270-4bbd-8390-b64045e84b60",
      "name": "enviar mensaje cuando el usuario tiene habitos",
      "webhookId": "e3d257fd-dd48-45f4-9820-82dafac9e269",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=¿En qué te puedo ayudar hoy?\n\nMenú principal:\n0. Ayuda\n1. Agenda (citas)\n2. Tareas\n3. Recordatorios\n4. Hábitos\n5. Listas\n6. Reportes\n7. Configuración\n8. Administrador",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -256,
        -2736
      ],
      "id": "424b1937-812a-408e-9d15-789871ab7841",
      "name": "enviar mensaje de menú principal1",
      "webhookId": "5c38a19b-f912-49e5-9501-b936c5b8a987",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 2120636757,
          "mode": "list",
          "cachedResultName": "SESSIONS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=2120636757"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telegram_user": "={{ $('normalización de datos').item.json.telegram_user }}",
            "pantalla_actual": "menu_reportes",
            "paso_actual": "0",
            "datos_parciales": "{}",
            "timestamp_ultima_interaccion": "={{ $now }}"
          },
          "matchingColumns": [
            "telegram_user"
          ],
          "schema": [
            {
              "id": "telegram_user",
              "displayName": "telegram_user",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pantalla_actual",
              "displayName": "pantalla_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "paso_actual",
              "displayName": "paso_actual",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "datos_parciales",
              "displayName": "datos_parciales",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timestamp_ultima_interaccion",
              "displayName": "timestamp_ultima_interaccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -96,
        -3152
      ],
      "id": "0010e19e-9274-4601-a025-2ebe689f1e05",
      "name": "actualizar sesión a menú reportes",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Reportes\n\n1. Reporte diario\n2. Reporte semanal\n3. Productividad (tareas)\n4. Hábitos (cumplimiento)\n5. Agenda (estado de citas)\n6. Productividad por usuario (reporte completo)\n9. Volver al menú principal",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        240,
        -3232
      ],
      "id": "456c26b7-d731-4dc6-b4e5-b853e9b83be0",
      "name": "enviar mensaje de menú reportes",
      "webhookId": "a629d150-b69c-4e3e-91b4-5f86742e8707",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "c950f8f1-b468-445c-8ab9-627ac46646e3",
              "leftValue": "={{ $('normalizar sesión actual').item.json.pantalla_actual }}",
              "rightValue": "menu_reportes",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -336,
        -560
      ],
      "id": "82c44707-6c35-45d1-b9cc-5a6006bafea9",
      "name": "¿estoy en menú reportes?"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "feb75c01-7ac8-4a01-a32a-575462c08d32",
              "leftValue": "={{ $json.text }}",
              "rightValue": "1",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "4975b2bd-99d3-4c1b-84b3-1a3d1299e138",
              "leftValue": "={{ $json.text }}",
              "rightValue": "2",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "ce56a432-7e0b-4f0d-89fd-eb80c841c359",
              "leftValue": "={{ $json.text }}",
              "rightValue": "3",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "797a1a79-54bd-47eb-bf44-09596bd42347",
              "leftValue": "={{ $json.text }}",
              "rightValue": "4",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "2cbbdf96-d49d-4f82-a74d-e25800409aca",
              "leftValue": "={{ $json.text }}",
              "rightValue": "5",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "e522a6f6-4790-4116-aabd-efc2d5a21e59",
              "leftValue": "={{ $json.text }}",
              "rightValue": "6",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "94e54c76-2d3f-4bcc-b423-0785b05bbadb",
              "leftValue": "={{ $json.text }}",
              "rightValue": "9",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        80,
        -544
      ],
      "id": "c8d9ef23-5e44-4a29-8ba7-4922f96d5815",
      "name": "¿opción valida en menu_reportes?"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "73b677f2-c833-4093-87fc-0ca7e30f1137"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "reporte_diario"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "802ac865-06ca-4d5f-94c3-eb1ceeb8c5b9",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "reporte_semanal"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "1f30b58a-eba1-4662-a070-0aed3f5736f3",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "3",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "productividad_tareas"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "7f49e737-a584-47b7-917c-4d67bdbe2ecf",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "4",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "productividad_habitos"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "23a74db3-b970-43ca-a40e-4b0264ae210b",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "5",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "productividad_general"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        464,
        -880
      ],
      "id": "f32ec668-2a1e-4199-ad2b-78f1948bc637",
      "name": "opciones en menu_reportes"
    },
    {
      "parameters": {
        "chatId": "={{ $('normalización de datos').item.json.telegram_user }}",
        "text": "=Perfecto. Voy a generarte el reporte de productividad.\n\nEn un momento ya te lo muestro.",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        848,
        -720
      ],
      "id": "328d0fe7-790a-4e7e-b9fb-459d9361e623",
      "name": "Send a text message",
      "webhookId": "4af7bc33-2b17-456c-b793-f1ddfc949504",
      "credentials": {
        "telegramApi": {
          "id": "Ed1Qbsh1dnrbIQev",
          "name": "AgendaBot Campus"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1200,
        -864
      ],
      "id": "6f2c9c0c-b781-4210-b7b4-cf99db05cd0a",
      "name": "obtener todas las citas",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U",
          "mode": "list",
          "cachedResultName": "AgendaBot_DB",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "CITAS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11XQrS-DPM1LNCjGrkujGMu5Vjj27Mq3_Eq58rdRNp4U/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1200,
        -640
      ],
      "id": "818aec01-e494-460f-aba2-b2da68f0836c",
      "name": "obtener todas las tareas",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "QoTNXAVjw4z9et9a",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const result = {};\n\nfor (const item of items) {\n  const creadoPor = item.json.creado_por;\n  const estado = item.json.estado;\n\n  const esCita = item.json.id_cita != null;\n  const esTarea = item.json.id_tarea != null;\n\n  if (!result[creadoPor]) {\n    result[creadoPor] = {\n      creado_por: creadoPor,\n\n      citas: {\n        total: 0,\n        completadas_total: 0,\n        canceladas_total: 0,\n        completadas: [],\n        canceladas: []\n      },\n\n      tareas: {\n        total: 0,\n        finalizadas_total: 0,\n        pendientes_total: 0,\n        finalizadas: [],\n        pendientes: []\n      }\n    };\n  }\n\n  // ===== CITAS =====\n  if (esCita) {\n    result[creadoPor].citas.total += 1;\n\n    const citaBase = {\n      id_cita: item.json.id_cita,\n      fecha: item.json.fecha,\n      hora: item.json.hora\n    };\n\n    if (estado === \"completada\") {\n      result[creadoPor].citas.completadas_total += 1;\n      result[creadoPor].citas.completadas.push(citaBase);\n    } else if (estado === \"cancelada\") {\n      result[creadoPor].citas.canceladas_total += 1;\n      result[creadoPor].citas.canceladas.push(citaBase);\n    }\n  }\n\n  // ===== TAREAS =====\n  if (esTarea) {\n    result[creadoPor].tareas.total += 1;\n\n    const tareaBase = {\n      id_tarea: item.json.id_tarea,\n      titulo: item.json.titulo,\n      prioridad: item.json.prioridad\n    };\n\n    if (estado === \"finalizada\") {\n      result[creadoPor].tareas.finalizadas_total += 1;\n      result[creadoPor].tareas.finalizadas.push(tareaBase);\n    } else if (estado === \"pendiente\") {\n      result[creadoPor].tareas.pendientes_total += 1;\n      result[creadoPor].tareas.pendientes.push(tareaBase);\n    }\n  }\n}\n\nreturn Object.values(result).map(r => ({ json: r }));\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1664,
        -720
      ],
      "id": "714c1f27-ce1d-42b7-b77d-e420e70c641f",
      "name": "Code in JavaScript"
    }
  ],
  "pinData": {},
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "normalización de datos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "normalización de datos": {
      "main": [
        [
          {
            "node": "busca usuario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "busca usuario": {
      "main": [
        [
          {
            "node": "¿existe usuario?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿existe usuario?": {
      "main": [
        [
          {
            "node": "obtener sesión existente",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "crear usuario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "crear usuario": {
      "main": [
        [
          {
            "node": "crear sesión inicial",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "crear sesión inicial": {
      "main": [
        [
          {
            "node": "obtener sesión existente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "obtener sesión existente": {
      "main": [
        [
          {
            "node": "normalizar sesión actual",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "normalizar sesión actual": {
      "main": [
        [
          {
            "node": "¿estoy en menú principal?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿estoy en menú principal?": {
      "main": [
        [
          {
            "node": "¿opción valida?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿estoy en menú reportes?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿opción valida?": {
      "main": [
        [
          {
            "node": "opciones del menú principal",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "mensaje de opción invalida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "opciones del menú principal": {
      "main": [
        [
          {
            "node": "enviar ayuda y menú principal",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "actualizar sesión a menú agenda",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "actualizar sesión a menú tareas",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [
          {
            "node": "actualizar sesión a menú habitos",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [
          {
            "node": "actualizar sesión a menú reportes",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [
          {
            "node": "enviar mensaje de menú principal1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a menú agenda": {
      "main": [
        [
          {
            "node": "mensaje de menú agenda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar ayuda y menú principal": {
      "main": [
        [
          {
            "node": "log de ayuda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "mensaje de menú agenda": {
      "main": [
        [
          {
            "node": "log de menú agenda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿estoy en menú agenda?": {
      "main": [
        [
          {
            "node": "¿opción valida en menú agenda?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "enrutador wz",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿opción valida en menú agenda?": {
      "main": [
        [
          {
            "node": "opciones de menú agenda",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "mensaje opción invalida menú agenda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a wz_cita_fecha": {
      "main": [
        [
          {
            "node": "enviar mensaje agregar fecha a cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "opciones de menú agenda": {
      "main": [
        [
          {
            "node": "actualizar sesión a wz_cita_fecha",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "obtener todas las citas por el usuario",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [],
        [],
        [
          {
            "node": "actualizar sesión a menu_principal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje agregar fecha a cita": {
      "main": [
        [
          {
            "node": "log de pedir fecha en cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿canceló desde fecha?": {
      "main": [
        [
          {
            "node": "actualizar sesión a menú agenda después de cancelar desde fecha",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿fecha valida?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a menú agenda después de cancelar desde fecha": {
      "main": [
        [
          {
            "node": "enviar menú agenda después de cancelar desde fecha",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿fecha valida?": {
      "main": [
        [
          {
            "node": "guardar fecha en datos_parciales",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "enviar mensaje de fecha invalida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje de fecha invalida": {
      "main": [
        [
          {
            "node": "log fecha invalida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "guardar fecha en datos_parciales": {
      "main": [
        [
          {
            "node": "agregar fecha en datos_parciales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agregar fecha en datos_parciales": {
      "main": [
        [
          {
            "node": "actualizar sesión a wz_cita_hora",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a wz_cita_hora": {
      "main": [
        [
          {
            "node": "enviar mensaje agregar hora a cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje agregar hora a cita": {
      "main": [
        [
          {
            "node": "log de pedir hora en cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿canceló desde hora?": {
      "main": [
        [
          {
            "node": "actualizar sesión a menú agenda después de cancelar desde hora",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿hora valida?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a menú agenda después de cancelar desde hora": {
      "main": [
        [
          {
            "node": "enviar menú agenda después de cancelar desde hora",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿hora valida?": {
      "main": [
        [
          {
            "node": "guardar hora en datos_parciales",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "enviar mensaje de hora invalida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje de hora invalida": {
      "main": [
        [
          {
            "node": "log hora invalida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "guardar hora en datos_parciales": {
      "main": [
        [
          {
            "node": "agregar hora en datos_parciales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agregar hora en datos_parciales": {
      "main": [
        [
          {
            "node": "actualizar sesión a wz_cita_nombre",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a wz_cita_nombre": {
      "main": [
        [
          {
            "node": "enviar mensaje agregar nombre a cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje agregar nombre a cita": {
      "main": [
        [
          {
            "node": "log de pedir nombre en cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿canceló desde nombre?": {
      "main": [
        [
          {
            "node": "actualizar sesión a menú agenda después de cancelar desde nombre",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿nombre válido?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a menú agenda después de cancelar desde nombre": {
      "main": [
        [
          {
            "node": "enviar menú agenda después de cancelar desde nombre",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿nombre válido?": {
      "main": [
        [
          {
            "node": "guardar nombre en datos_parciales",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "enviar mensaje de nombre invalido",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje de nombre invalido": {
      "main": [
        [
          {
            "node": "log nombre invalido",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "guardar nombre en datos_parciales": {
      "main": [
        [
          {
            "node": "agregar nombre en datos_parciales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agregar nombre en datos_parciales": {
      "main": [
        [
          {
            "node": "actualizar sesión a wz_cita_motivo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a wz_cita_motivo": {
      "main": [
        [
          {
            "node": "enviar mensaje agregar motivo a cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje agregar motivo a cita": {
      "main": [
        [
          {
            "node": "log de pedir motivo en cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿canceló desde motivo?": {
      "main": [
        [
          {
            "node": "actualizar sesión a menú agenda después de cancelar desde motivo",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿motivo valido?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a menú agenda después de cancelar desde motivo": {
      "main": [
        [
          {
            "node": "enviar menú agenda después de cancelar desde motivo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿motivo valido?": {
      "main": [
        [
          {
            "node": "guardar motivo en datos_parciales",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "enviar mensaje de motivo invalido",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje de motivo invalido": {
      "main": [
        [
          {
            "node": "log motivo invalido",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "guardar motivo en datos_parciales": {
      "main": [
        [
          {
            "node": "agregar motivo en datos_parciales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a wz_cita_canal": {
      "main": [
        [
          {
            "node": "enviar mensaje agregar canal cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje agregar canal cita": {
      "main": [
        [
          {
            "node": "log de pedir canal en cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿canceló desde canal?": {
      "main": [
        [
          {
            "node": "actualizar sesión a menú agenda después de cancelar desde canal",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿canal válido?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿canal válido?": {
      "main": [
        [
          {
            "node": "elección de canal",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "enviar mensaje de canal invalido",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "elección de canal": {
      "main": [
        [
          {
            "node": "guardar canal presencial en datos_parciales",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "guardar canal virtual en datos_parciales",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "guardar canal llamada en datos_parciales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "guardar canal presencial en datos_parciales": {
      "main": [
        [
          {
            "node": "agregar canal presencial en datos_parciales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agregar motivo en datos_parciales": {
      "main": [
        [
          {
            "node": "actualizar sesión a wz_cita_canal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "guardar canal llamada en datos_parciales": {
      "main": [
        [
          {
            "node": "agregar canal llamada en datos_parciales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "guardar canal virtual en datos_parciales": {
      "main": [
        [
          {
            "node": "agregar canal virtual en datos_parciales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agregar canal presencial en datos_parciales": {
      "main": [
        [
          {
            "node": "actualizar sesión a wz_cita_confirm desde presencial",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agregar canal llamada en datos_parciales": {
      "main": [
        [
          {
            "node": "actualizar sesión a wz_cita_confirm desde llamada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agregar canal virtual en datos_parciales": {
      "main": [
        [
          {
            "node": "actualizar sesión a wz_cita_confirm desde virtual",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a wz_cita_confirm desde presencial": {
      "main": [
        [
          {
            "node": "enviar mensaje confirmar cita desde canal presencial",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a wz_cita_confirm desde virtual": {
      "main": [
        [
          {
            "node": "enviar mensaje confirmar cita desde canal virtual",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a wz_cita_confirm desde llamada": {
      "main": [
        [
          {
            "node": "enviar mensaje confirmar cita desde canal llamada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a menú agenda después de cancelar desde canal": {
      "main": [
        [
          {
            "node": "enviar menú agenda después de cancelar desde canal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje de canal invalido": {
      "main": [
        [
          {
            "node": "log canal invalido",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje confirmar cita desde canal presencial": {
      "main": [
        [
          {
            "node": "log de pedir confirmación en cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje confirmar cita desde canal virtual": {
      "main": [
        [
          {
            "node": "log de pedir confirmación en cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje confirmar cita desde canal llamada": {
      "main": [
        [
          {
            "node": "log de pedir confirmación en cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿opción valida desde confirmación?": {
      "main": [
        [
          {
            "node": "elección de opciones de confirmación",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "enviar mensaje de opción de confirmación invalida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje de opción de confirmación invalida": {
      "main": [
        [
          {
            "node": "log opción de confirmación invalida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "elección de opciones de confirmación": {
      "main": [
        [
          {
            "node": "generar nuevo id para cita",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "actualizar sesión después de editar en confirmación",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "actualizar sesión después de cancelar desde confirmación",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión después de cancelar desde confirmación": {
      "main": [
        [
          {
            "node": "enviar menú agenda después de cancelar desde confirmación",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar menú agenda después de cancelar desde confirmación": {
      "main": [
        [
          {
            "node": "log de cancelar después de cancelar desde confirmación",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión después de editar en confirmación": {
      "main": [
        [
          {
            "node": "enviar menú fecha después de editar en confirmación",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar menú fecha después de editar en confirmación": {
      "main": [
        [
          {
            "node": "log de editar después de editar desde confirmación",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "normalizar datos_parciales": {
      "main": [
        [
          {
            "node": "agendar cita",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agendar cita": {
      "main": [
        [
          {
            "node": "actualizar sesión a exitos después de confirmar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "generar nuevo id para cita": {
      "main": [
        [
          {
            "node": "normalizar datos_parciales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje de confirmación exitosa": {
      "main": [
        [
          {
            "node": "log después de confirmación exitosa",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a exitos después de confirmar": {
      "main": [
        [
          {
            "node": "enviar mensaje de confirmación exitosa",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿acción de salida en citas válida?": {
      "main": [
        [
          {
            "node": "elección de opciones de acción de salida en citas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "enviar mensaje de opción de acción de salida en citas invalida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje de opción de acción de salida en citas invalida": {
      "main": [
        [
          {
            "node": "log de opción de acción de salida en citas invalida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "elección de opciones de acción de salida en citas": {
      "main": [
        [
          {
            "node": "actualizar sesión después de seleccionar acción de menú agenda",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "actualizar sesión después de seleccionar acción de menú principal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión después de seleccionar acción de menú agenda": {
      "main": [
        [
          {
            "node": "enviar menú agenda después de seleccionar acción de menú agenda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar menú agenda después de seleccionar acción de menú agenda": {
      "main": [
        [
          {
            "node": "log seleccionar acción de menú agenda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión después de seleccionar acción de menú principal": {
      "main": [
        [
          {
            "node": "enviar menú agenda después de seleccionar acción de menú principal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar menú agenda después de seleccionar acción de menú principal": {
      "main": [
        [
          {
            "node": "log seleccionar acción de menú principal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "obtener todas las citas por el usuario": {
      "main": [
        [
          {
            "node": "normalizar citas por usuario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿el usuario tiene citas?": {
      "main": [
        [
          {
            "node": "limitar citas del usuario",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "enviar mensaje cuando el usuario no tiene citas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "normalizar citas por usuario": {
      "main": [
        [
          {
            "node": "¿el usuario tiene citas?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje cuando el paciente tiene citas": {
      "main": [
        [
          {
            "node": "limitar citas del usuario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "limitar citas del usuario": {
      "main": [
        [
          {
            "node": "agrupar en un solo item final",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "enviar mensaje cuando el paciente tiene citas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agrupar en un solo item final": {
      "main": [
        [
          {
            "node": "enviar mensaje después de enviar todas las citas del usuario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje cuando el usuario no tiene citas": {
      "main": [
        [
          {
            "node": "log cuando el usuario no tiene citas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje después de enviar todas las citas del usuario": {
      "main": [
        [
          {
            "node": "log cuando el usuario tiene citas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a menu_principal": {
      "main": [
        [
          {
            "node": "enviar mensaje de menú principal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje de menú principal": {
      "main": [
        [
          {
            "node": "log de enviar menu_principal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a menú tareas": {
      "main": [
        [
          {
            "node": "mensaje de menú tareas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "mensaje de menú tareas": {
      "main": [
        [
          {
            "node": "log de menú tareas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿estoy en menú tareas?": {
      "main": [
        [
          {
            "node": "¿estoy en menú agenda?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿opción válida en menú tareas?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿opción válida en menú tareas?": {
      "main": [
        [
          {
            "node": "opciones de menú tareas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "mensaje de opción invalida en menú tareas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "opciones de menú tareas": {
      "main": [
        [
          {
            "node": "actualizar sesión a wz_tarea_titulo",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "obtener todas las tareas por el usuario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a wz_tarea_titulo": {
      "main": [
        [
          {
            "node": "enviar mensaje para agregar titulo a la tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje para agregar titulo a la tarea": {
      "main": [
        [
          {
            "node": "log de pedir titulo a tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enrutador wz": {
      "main": [
        [
          {
            "node": "¿canceló desde fecha?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿canceló desde hora?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿canceló desde nombre?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿canceló desde motivo?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿canceló desde canal?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿opción valida desde confirmación?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿acción de salida en citas válida?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿canceló desde titulo?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿canceló desde prioridad?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿canceló desde confirmar?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿canceló desde nombre de habito?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿canceló desde frecuencia?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿canceló desde hora de habito?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿opción valida de confirmación desde habito?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿opción invalida en éxito?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿canceló desde titulo?": {
      "main": [
        [
          {
            "node": "actualizar sesión a menú tareas después de cancelar desde titulo",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿titulo válido?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a menú tareas después de cancelar desde titulo": {
      "main": [
        [
          {
            "node": "enviar menú tareas después de cancelar después de pedir titulo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿titulo válido?": {
      "main": [
        [
          {
            "node": "guardar titulo de tareas en datos_parciales",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "enviar mensaje de titulo invalido",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "guardar titulo de tareas en datos_parciales": {
      "main": [
        [
          {
            "node": "agregar titulo de tarea a datos_parciales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agregar titulo de tarea a datos_parciales": {
      "main": [
        [
          {
            "node": "actualizar sesión a wz_tarea_prioridad",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a wz_tarea_prioridad": {
      "main": [
        [
          {
            "node": "enviar mensaje de prioridad de tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje de prioridad de tarea": {
      "main": [
        [
          {
            "node": "log de pedir prioridad en tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿canceló desde prioridad?": {
      "main": [
        [
          {
            "node": "actualizar sesión a menú tareas después de cancelar desde prioridad",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿opción validad desde prioridad de tarea?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a menú tareas después de cancelar desde prioridad": {
      "main": [
        [
          {
            "node": "enviar menú tareas después de cancelar después de pedir prioridad",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿opción validad desde prioridad de tarea?": {
      "main": [
        [
          {
            "node": "elección de prioridad de tarea",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "enviar mensaje de opción invalida en prioridades de tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "elección de prioridad de tarea": {
      "main": [
        [
          {
            "node": "guardar prioridad alta de tarea en datos_parciales",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "guardar prioridad media de tarea en datos_parciales",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "guardar prioridad baja de tarea en datos_parciales",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "actualizar sesión desde prioridad de tarea después de cancelar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "guardar prioridad alta de tarea en datos_parciales": {
      "main": [
        [
          {
            "node": "agregar prioridad alta de tarea en datos_parciales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "guardar prioridad media de tarea en datos_parciales": {
      "main": [
        [
          {
            "node": "agregar prioridad media de tarea en datos_parciales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "guardar prioridad baja de tarea en datos_parciales": {
      "main": [
        [
          {
            "node": "agregar prioridad baja de tarea en datos_parciales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agregar prioridad alta de tarea en datos_parciales": {
      "main": [
        [
          {
            "node": "actualizar sesión a wz_tarea_confirm desde prioridad alta tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agregar prioridad media de tarea en datos_parciales": {
      "main": [
        [
          {
            "node": "actualizar sesión a wz_tarea_confirm desde prioridad media tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agregar prioridad baja de tarea en datos_parciales": {
      "main": [
        [
          {
            "node": "actualizar sesión a wz_tarea_confirm desde prioridad baja tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a wz_tarea_confirm desde prioridad alta tarea": {
      "main": [
        [
          {
            "node": "enviar mensaje de confirmación de tarea desde prioridad",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a wz_tarea_confirm desde prioridad media tarea": {
      "main": [
        [
          {
            "node": "enviar mensaje de confirmación de tarea desde prioridad",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a wz_tarea_confirm desde prioridad baja tarea": {
      "main": [
        [
          {
            "node": "enviar mensaje de confirmación de tarea desde prioridad",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión desde prioridad de tarea después de cancelar": {
      "main": [
        [
          {
            "node": "enviar menú tarea después de cancelar desde prioridad de tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿canceló desde confirmar?": {
      "main": [
        [
          {
            "node": "actualizar sesión a menú tareas después de cancelar desde confirmar",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿opción valida desde confirmar tarea?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a menú tareas después de cancelar desde confirmar": {
      "main": [
        [
          {
            "node": "enviar menú tareas después de cancelar después de pedir confirmar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿opción valida desde confirmar tarea?": {
      "main": [
        [
          {
            "node": "elección de confirmar tarea",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "enviar mensaje de opción invalida en confirmación de tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "elección de confirmar tarea": {
      "main": [
        [
          {
            "node": "generar nuevo id para tarea",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "actualizar sesión a editar después de la elección desde confirmar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a editar después de la elección desde confirmar": {
      "main": [
        [
          {
            "node": "enviar mensaje después de editar tarea en opciones de confirmar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "generar nuevo id para tarea": {
      "main": [
        [
          {
            "node": "normalizar datos_parciales1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "normalizar datos_parciales1": {
      "main": [
        [
          {
            "node": "crear tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "crear tarea": {
      "main": [
        [
          {
            "node": "actualizar sesión después de crear tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión después de crear tarea": {
      "main": [
        [
          {
            "node": "enviar menú tareas después de confirmar tarea",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "obtener todas las tareas por el usuario": {
      "main": [
        [
          {
            "node": "normalizar tareas por usuarios",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "normalizar tareas por usuarios": {
      "main": [
        [
          {
            "node": "¿el usuario tiene tareas?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿el usuario tiene tareas?": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "enviar mensaje cuando el usuario no tiene tareas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "agrupar en un solo item las tareas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "enviar mensaje cuando el usuario tiene tareas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje cuando el usuario tiene tareas": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agrupar en un solo item las tareas": {
      "main": [
        [
          {
            "node": "actualizar sesión a menú tareas desde ver tareas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje después de enviar todas las tareas por el usuario": {
      "main": [
        []
      ]
    },
    "actualizar sesión a menú tareas desde ver tareas": {
      "main": [
        [
          {
            "node": "enviar mensaje después de enviar todas las tareas por el usuario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a menú habitos": {
      "main": [
        [
          {
            "node": "enviar mensaje de menú habitos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿estoy en menú habitos?": {
      "main": [
        [
          {
            "node": "¿estoy en menú tareas?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿opción válida en menú habitos?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿opción válida en menú habitos?": {
      "main": [
        [
          {
            "node": "opciones menú habitos",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "mensaje de opción invalida en menú habitos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "opciones menú habitos": {
      "main": [
        [
          {
            "node": "actualizar sesión a wz_habito_nombre",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "obtener todos los habitos del usuario",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "actualizar sesión a menú principal con opción en menú habitos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a menú principal con opción en menú habitos": {
      "main": [
        [
          {
            "node": "enviar menú principal desde menú habitos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a wz_habito_nombre": {
      "main": [
        [
          {
            "node": "enviar mensaje para añadir nombre a habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿canceló desde nombre de habito?": {
      "main": [
        [
          {
            "node": "actualizar sesión a menú habito después de cancelar desde nombre de habito",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿nombre de habito válido?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a menú habito después de cancelar desde nombre de habito": {
      "main": [
        [
          {
            "node": "enviar menú habitos después de cancelar después de pedir nombre de habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿nombre de habito válido?": {
      "main": [
        [
          {
            "node": "guardar nombre de habito en datos_parciales",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "enviar mensaje de nombre de habito invalido",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "guardar nombre de habito en datos_parciales": {
      "main": [
        [
          {
            "node": "agregar nombre de habitoa datos_parciales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agregar nombre de habitoa datos_parciales": {
      "main": [
        [
          {
            "node": "actualizar sesión a wz_habito_frecuencia",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a wz_habito_frecuencia": {
      "main": [
        [
          {
            "node": "enviar mensaje de frecuencia de habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje de frecuencia de habito": {
      "main": [
        []
      ]
    },
    "¿canceló desde frecuencia?": {
      "main": [
        [
          {
            "node": "actualizar sesión a menú habito después de cancelar desde frecuencia de habito",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿opción valida en frecuencia de habito?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a menú habito después de cancelar desde frecuencia de habito": {
      "main": [
        [
          {
            "node": "enviar menú habitos después de cancelar después de pedir frecuencia de habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿opción valida en frecuencia de habito?": {
      "main": [
        [
          {
            "node": "elección de frecuencia de habito",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "enviar mensaje de opción invalida en frecuencia de habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "elección de frecuencia de habito": {
      "main": [
        [
          {
            "node": "guardar frecuencia alta en datos_parciales",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "guardar frecuencia baja en datos_parciales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "guardar frecuencia alta en datos_parciales": {
      "main": [
        [
          {
            "node": "agregar frecuencia alta en datos_parciales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "guardar frecuencia baja en datos_parciales": {
      "main": [
        [
          {
            "node": "agregar frecuencia baja en datos_parciales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agregar frecuencia alta en datos_parciales": {
      "main": [
        [
          {
            "node": "actualizar sesión a wz_habito_hora desde frecuencia alta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agregar frecuencia baja en datos_parciales": {
      "main": [
        [
          {
            "node": "actualizar sesión a wz_habito_hora desde frecuencia baja",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a wz_habito_hora desde frecuencia alta": {
      "main": [
        [
          {
            "node": "enviar mensaje de hora habito desde frecuencia alta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a wz_habito_hora desde frecuencia baja": {
      "main": [
        [
          {
            "node": "enviar mensaje de hora habito desde frecuencia baja",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿canceló desde hora de habito?": {
      "main": [
        [
          {
            "node": "actualizar sesión a menú habitos desde cancelar en hora habito",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿hora de habito válida?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a menú habitos desde cancelar en hora habito": {
      "main": [
        [
          {
            "node": "enviar mensaje de cancelar desde hora de habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿hora de habito válida?": {
      "main": [
        [
          {
            "node": "guardar hora de habito en datos_parciales",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "enviar mensaje de hora de habito invalida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "guardar hora de habito en datos_parciales": {
      "main": [
        [
          {
            "node": "agregar hora de habito en datos_parciales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agregar hora de habito en datos_parciales": {
      "main": [
        [
          {
            "node": "actualizar sesión a wz_habito_confirm",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a wz_habito_confirm": {
      "main": [
        [
          {
            "node": "enviar mensaje de confirmar desde hora habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿opción valida de confirmación desde habito?": {
      "main": [
        [
          {
            "node": "elección de confirmación desde habito",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "enviar mensaje de opción invalida desde confirmación de habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "elección de confirmación desde habito": {
      "main": [
        [
          {
            "node": "generar nuevo id para habito",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "actualizar sesión después de editar en habitos",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "actualizar sesión después de cancelar en habitos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "generar nuevo id para habito": {
      "main": [
        [
          {
            "node": "normalizar datos_parciales de habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "normalizar datos_parciales de habito": {
      "main": [
        [
          {
            "node": "crear habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "crear habito": {
      "main": [
        [
          {
            "node": "actualizar sesión a exitos después de confirmar habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a exitos después de confirmar habito": {
      "main": [
        [
          {
            "node": "enviar mensaje de confirmación exitosa de habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión después de editar en habitos": {
      "main": [
        [
          {
            "node": "enviar menú nombre después de editar en habitos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión después de cancelar en habitos": {
      "main": [
        [
          {
            "node": "enviar menú habitos después de cancelar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿opción invalida en éxito?": {
      "main": [
        [
          {
            "node": "elección de opciones de acción de salida en habitos",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "enviar mensaje de opción invalida desde éxito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "elección de opciones de acción de salida en habitos": {
      "main": [
        [
          {
            "node": "actualizar sesión después de seleccionar menú habito",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "actualizar sesión después de seleccionar menú principal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión después de seleccionar menú habito": {
      "main": [
        [
          {
            "node": "enviar menú habitos desde opción menú habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión después de seleccionar menú principal": {
      "main": [
        [
          {
            "node": "enviar menú principal desde opción menú habito",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "obtener todos los habitos del usuario": {
      "main": [
        [
          {
            "node": "normalizar todos los habitos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "normalizar todos los habitos": {
      "main": [
        [
          {
            "node": "¿el usuario tiene habitos?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [
          {
            "node": "agrupar en un solo item los habitos",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "enviar mensaje cuando el usuario tiene habitos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿el usuario tiene habitos?": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "enviar mensaje cuando el usuario no tiene habitos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agrupar en un solo item los habitos": {
      "main": [
        [
          {
            "node": "actualizar sesión a menú habitos desde ver habitos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a menú habitos desde ver habitos": {
      "main": [
        [
          {
            "node": "enviar mensaje después de enviar todos los habitos por el usuario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar mensaje cuando el usuario tiene habitos": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "actualizar sesión a menú reportes": {
      "main": [
        [
          {
            "node": "enviar mensaje de menú reportes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿estoy en menú reportes?": {
      "main": [
        [
          {
            "node": "¿estoy en menú habitos?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "¿opción valida en menu_reportes?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "¿opción valida en menu_reportes?": {
      "main": [
        [
          {
            "node": "opciones en menu_reportes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "opciones en menu_reportes": {
      "main": [
        [],
        [],
        [],
        [],
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message": {
      "main": [
        [
          {
            "node": "obtener todas las citas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "obtener todas las citas": {
      "main": [
        [
          {
            "node": "obtener todas las tareas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "obtener todas las tareas": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "f99046da-4128-4036-887a-c765f1343307",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "a2243de902ea74b5b663537c3e3742969b5833ba80f205b39d5bc0bf3e21b209"
  },
  "id": "k0an7uNNSL_ona8JoDhgN",
  "tags": []
}